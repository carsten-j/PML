
<!-- saved from url=(0065)https://wouterboomsma.github.io/pml2024/week6/score_matching.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="color-scheme" content="light dark"></head><body><div class="line-gutter-backdrop"></div><form autocomplete="off"><label class="line-wrap-control">Line wrap<input type="checkbox" aria-label="Line wrap"></label></form><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-doctype">&lt;!doctype html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;html&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content">	<span class="html-tag">&lt;head&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content">		<span class="html-tag">&lt;meta <span class="html-attribute-name">charset</span>="<span class="html-attribute-value">utf-8</span>"&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content">		<span class="html-tag">&lt;meta <span class="html-attribute-name">name</span>="<span class="html-attribute-value">viewport</span>" <span class="html-attribute-name">content</span>="<span class="html-attribute-value">width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no</span>"&gt;</span></td></tr><tr><td class="line-number" value="6"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="7"></td><td class="line-content">		<span class="html-tag">&lt;title&gt;</span>Probabilistic Machine Learning<span class="html-tag">&lt;/title&gt;</span></td></tr><tr><td class="line-number" value="8"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="9"></td><td class="line-content">		<span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/dist/reset.css" rel="noreferrer noopener">../reveal.js-4.5.0/dist/reset.css</a>"&gt;</span></td></tr><tr><td class="line-number" value="10"></td><td class="line-content">		<span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/dist/reveal.css" rel="noreferrer noopener">../reveal.js-4.5.0/dist/reveal.css</a>"&gt;</span></td></tr><tr><td class="line-number" value="11"></td><td class="line-content">		<span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/dist/theme/white-helv.css" rel="noreferrer noopener">../reveal.js-4.5.0/dist/theme/white-helv.css</a>"&gt;</span></td></tr><tr><td class="line-number" value="12"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="13"></td><td class="line-content">		<span class="html-comment">&lt;!-- Theme used for syntax highlighted code --&gt;</span></td></tr><tr><td class="line-number" value="14"></td><td class="line-content">		<span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/googlecode.css" rel="noreferrer noopener">../googlecode.css</a>"&gt;</span></td></tr><tr><td class="line-number" value="15"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="16"></td><td class="line-content">		<span class="html-tag">&lt;style&gt;</span></td></tr><tr><td class="line-number" value="17"></td><td class="line-content">			.reveal .slides {</td></tr><tr><td class="line-number" value="18"></td><td class="line-content">				text-align: left;</td></tr><tr><td class="line-number" value="19"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="20"></td><td class="line-content">			.reveal a {</td></tr><tr><td class="line-number" value="21"></td><td class="line-content">				color:DarkSlateBlue;</td></tr><tr><td class="line-number" value="22"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="23"></td><td class="line-content">			.reveal section img {</td></tr><tr><td class="line-number" value="24"></td><td class="line-content">				border: 1px solid lightgrey;</td></tr><tr><td class="line-number" value="25"></td><td class="line-content">				box-shadow: none;</td></tr><tr><td class="line-number" value="26"></td><td class="line-content">				margin:0;</td></tr><tr><td class="line-number" value="27"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="28"></td><td class="line-content">			.reveal section img.noborder {</td></tr><tr><td class="line-number" value="29"></td><td class="line-content">				border: none;</td></tr><tr><td class="line-number" value="30"></td><td class="line-content">				box-shadow: none;</td></tr><tr><td class="line-number" value="31"></td><td class="line-content">				margin:0</td></tr><tr><td class="line-number" value="32"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">			.reveal section img.center {</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">				display: block;</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">				margin: 0 auto;</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="37"></td><td class="line-content">			.reveal section div.container{</td></tr><tr><td class="line-number" value="38"></td><td class="line-content">				display: flex;</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="40"></td><td class="line-content">			.reveal section div.container div{</td></tr><tr><td class="line-number" value="41"></td><td class="line-content">				flex: 1;</td></tr><tr><td class="line-number" value="42"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="43"></td><td class="line-content">			.reveal dt.spaced {</td></tr><tr><td class="line-number" value="44"></td><td class="line-content">				margin-top:0.5em;</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="46"></td><td class="line-content">			.MathJax_Display {</td></tr><tr><td class="line-number" value="47"></td><td class="line-content">				font-size: 75% !important;</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">			.katex {</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">				font-size: 100% !important;</td></tr><tr><td class="line-number" value="51"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="52"></td><td class="line-content">			.reveal .katex-display {</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">				margin-top:0.25em;</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">				margin-bottom:0.25em;</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">			.reveal .katex-display&gt;.katex {</td></tr><tr><td class="line-number" value="57"></td><td class="line-content">				text-align:left;</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">				margin-left:1em;</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="60"></td><td class="line-content">			.reveal section dl.list dt {</td></tr><tr><td class="line-number" value="61"></td><td class="line-content">				display:list-item;</td></tr><tr><td class="line-number" value="62"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="63"></td><td class="line-content">			.reveal section dl.list dd {</td></tr><tr><td class="line-number" value="64"></td><td class="line-content">				margin-left:0;</td></tr><tr><td class="line-number" value="65"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="66"></td><td class="line-content">			a.popup-q {</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">				background:grey;</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">				color:white;</td></tr><tr><td class="line-number" value="69"></td><td class="line-content">				border-radius:100%;</td></tr><tr><td class="line-number" value="70"></td><td class="line-content">				text-align:center;</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">				font-size:60%;</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">				padding:0.1em;</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">				top:0.0em;</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">				line-height:1.1em;</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">				display:inline-block;</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">				cursor:pointer;</td></tr><tr><td class="line-number" value="77"></td><td class="line-content">				width:1em;</td></tr><tr><td class="line-number" value="78"></td><td class="line-content">				height:1em;</td></tr><tr><td class="line-number" value="79"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="80"></td><td class="line-content">			.popup {</td></tr><tr><td class="line-number" value="81"></td><td class="line-content">				display: none;</td></tr><tr><td class="line-number" value="82"></td><td class="line-content">				position: absolute;</td></tr><tr><td class="line-number" value="83"></td><td class="line-content">				top:50%;</td></tr><tr><td class="line-number" value="84"></td><td class="line-content">				left:50%;</td></tr><tr><td class="line-number" value="85"></td><td class="line-content">				transform: translate(-50%, -50%);</td></tr><tr><td class="line-number" value="86"></td><td class="line-content">				width: 80%;</td></tr><tr><td class="line-number" value="87"></td><td class="line-content">				font-size:80%;</td></tr><tr><td class="line-number" value="88"></td><td class="line-content">				/*margin-left:-50px;*/</td></tr><tr><td class="line-number" value="89"></td><td class="line-content">				background-color: #fff;</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">				padding: 0.25em 0.5em 0em 0.5em;</td></tr><tr><td class="line-number" value="91"></td><td class="line-content">				border: solid 1px #999;</td></tr><tr><td class="line-number" value="92"></td><td class="line-content">				z-index:100;</td></tr><tr><td class="line-number" value="93"></td><td class="line-content">				/*@include border-radius(5px);*/</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">				/*@include box-shadow(0 4px 10px rgba(#000,.5));*/</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="96"></td><td class="line-content">			.popup-close {</td></tr><tr><td class="line-number" value="97"></td><td class="line-content">				position: absolute;</td></tr><tr><td class="line-number" value="98"></td><td class="line-content">				right: 10px;</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">				top: 0px;</td></tr><tr><td class="line-number" value="100"></td><td class="line-content">				/*background-color: black;*/</td></tr><tr><td class="line-number" value="101"></td><td class="line-content">				color: black;</td></tr><tr><td class="line-number" value="102"></td><td class="line-content">				border-radius: 50%;</td></tr><tr><td class="line-number" value="103"></td><td class="line-content">				padding: 4px;</td></tr><tr><td class="line-number" value="104"></td><td class="line-content">				cursor:pointer;</td></tr><tr><td class="line-number" value="105"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="106"></td><td class="line-content">			.fragment.semi {</td></tr><tr><td class="line-number" value="107"></td><td class="line-content">				opacity:10%;</td></tr><tr><td class="line-number" value="108"></td><td class="line-content">   				/*filter: blur(10px);*/</td></tr><tr><td class="line-number" value="109"></td><td class="line-content">  			}</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">  			.fragment.semi.visible {</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">				opacity:100%;</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">    			/*filter: none;*/</td></tr><tr><td class="line-number" value="113"></td><td class="line-content">  			}			</td></tr><tr><td class="line-number" value="114"></td><td class="line-content">		<span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="115"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="116"></td><td class="line-content">	<span class="html-tag">&lt;/head&gt;</span></td></tr><tr><td class="line-number" value="117"></td><td class="line-content">	<span class="html-tag">&lt;body&gt;</span></td></tr><tr><td class="line-number" value="118"></td><td class="line-content">		<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">reveal</span>"&gt;</span></td></tr><tr><td class="line-number" value="119"></td><td class="line-content">			<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">slides</span>"&gt;</span></td></tr><tr><td class="line-number" value="120"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="121"></td><td class="line-content">				<span class="html-tag">&lt;section&gt;</span></td></tr><tr><td class="line-number" value="122"></td><td class="line-content">					<span class="html-tag">&lt;br/&gt;</span></td></tr><tr><td class="line-number" value="123"></td><td class="line-content">					<span class="html-tag">&lt;h1&gt;</span>Probabilistic <span class="html-tag">&lt;br&gt;</span>Machine Learning<span class="html-tag">&lt;/h1&gt;</span></td></tr><tr><td class="line-number" value="124"></td><td class="line-content">					<span class="html-tag">&lt;h4&gt;</span>Week 6, Thursday<span class="html-tag">&lt;/h4&gt;</span></td></tr><tr><td class="line-number" value="125"></td><td class="line-content">					<span class="html-comment">&lt;!-- &lt;dl&gt; --&gt;</span></td></tr><tr><td class="line-number" value="126"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">text-align:left; font-size:100%; border:1px solid lightgrey; background-color: #fafafa; padding:0.5em; display:inline-block; margin-top:0em</span>"&gt;</span></td></tr><tr><td class="line-number" value="127"></td><td class="line-content">						<span class="html-tag">&lt;dl <span class="html-attribute-name">class</span>="<span class="html-attribute-value">list</span>"&gt;</span></td></tr><tr><td class="line-number" value="128"></td><td class="line-content">							<span class="html-tag">&lt;dt&gt;</span>Some more details on denoising diffusion probabilistic models (DDPMs)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="129"></td><td class="line-content">							<span class="html-tag">&lt;dt&gt;</span>Score matching probabilistic models<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="130"></td><td class="line-content">							<span class="html-comment">&lt;!-- &lt;dt&gt;Flow matching&lt;/dt&gt; --&gt;</span></td></tr><tr><td class="line-number" value="131"></td><td class="line-content">						<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="132"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="133"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="134"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="135"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">text-align:center</span>"&gt;</span></td></tr><tr><td class="line-number" value="136"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based <span class="html-tag">&lt;br&gt;</span>Probabilistic Models<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="137"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="138"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="139"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="140"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Hierarchical VAE (1)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="141"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="142"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="143"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">flex-grow: 3.5;</span>"&gt;</span></td></tr><tr><td class="line-number" value="144"></td><td class="line-content">							As we discussed, we could increase the sampling quality of variational autoencoders by making them hierarchical.</td></tr><tr><td class="line-number" value="145"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="146"></td><td class="line-content">							Let's write up the model, integrating out all latents:</td></tr><tr><td class="line-number" value="147"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="148"></td><td class="line-content">							\[p_{\boldsymbol \theta}(\boldsymbol x) = \int \int p_{\boldsymbol \theta}(\boldsymbol x, \boldsymbol z_1, \boldsymbol z_2) d\boldsymbol z_1 d\boldsymbol z_2\]</td></tr><tr><td class="line-number" value="149"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="150"></td><td class="line-content">							<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="151"></td><td class="line-content">							Since we will be talking about hierarchies of many layers, we will use the notation \(\boldsymbol z_{1:T}\), and write</td></tr><tr><td class="line-number" value="152"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="153"></td><td class="line-content">							\[\begin{align*}</td></tr><tr><td class="line-number" value="154"></td><td class="line-content">							p_{\boldsymbol \theta}(\boldsymbol x) &amp;= \int p_{\boldsymbol \theta}(\boldsymbol x, \boldsymbol z_{1:T}) d\boldsymbol z_{1:T} \\</td></tr><tr><td class="line-number" value="155"></td><td class="line-content">							p_{\boldsymbol \theta}(\boldsymbol x, \boldsymbol z_{1:T})&amp;= p(\boldsymbol x|\boldsymbol z_1) \prod_{t=1}^{T-1} p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})p_{\boldsymbol \theta}(\boldsymbol z_T)\end{align*}\]</td></tr><tr><td class="line-number" value="156"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="157"></td><td class="line-content">							<span class="html-tag">&lt;/span&gt;</span>							</td></tr><tr><td class="line-number" value="158"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span>						</td></tr><tr><td class="line-number" value="159"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="160"></td><td class="line-content">						<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="161"></td><td class="line-content">							<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">noborder</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:100%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/week6/hierarchical_vae_1.svg" rel="noreferrer noopener">hierarchical_vae_1.svg</a>"&gt;</span></td></tr><tr><td class="line-number" value="162"></td><td class="line-content">							<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">noborder</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:100%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/week6/hierarchical_vae_2.svg" rel="noreferrer noopener">hierarchical_vae_2.svg</a>"&gt;</span>		</td></tr><tr><td class="line-number" value="163"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="164"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="165"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="166"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="167"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="168"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="169"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="170"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="171"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Hierarchical VAE (2)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="172"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="173"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="174"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">flex-grow: 2.5;</span>"&gt;</span></td></tr><tr><td class="line-number" value="175"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="176"></td><td class="line-content">							<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border:1px solid lightgrey;</span>"&gt;</span></td></tr><tr><td class="line-number" value="177"></td><td class="line-content">							\[p_{\boldsymbol \theta}(\boldsymbol x, \boldsymbol z_{1:T}) = p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) \prod_{t=1}^{T-1} p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})p_{\boldsymbol \theta}(\boldsymbol z_T)\]</td></tr><tr><td class="line-number" value="178"></td><td class="line-content">							<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="179"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="180"></td><td class="line-content">							We can choose a variational distribution \(q(\boldsymbol z_{1:T}|\boldsymbol x)\) that factorizes in a similar way:</td></tr><tr><td class="line-number" value="181"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="182"></td><td class="line-content">							\[q_{\boldsymbol \phi}(\boldsymbol z_{1:T}|\boldsymbol x) = q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x)\prod_{t=2}^{T} q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1})\]</td></tr><tr><td class="line-number" value="183"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="184"></td><td class="line-content">							<span class="html-comment">&lt;!-- And write up the ELBO:</span></td></tr><tr><td class="line-number" value="185"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="186"></td><td class="line-content"><span class="html-comment">							\[\begin{align*}\ln p_{\boldsymbol \theta}(x) &amp;= \ln \int p_{\boldsymbol \theta}(\boldsymbol x,\boldsymbol z_{1:T})d \boldsymbol z_{1:T} \end{align*}\]</span></td></tr><tr><td class="line-number" value="187"></td><td class="line-content"><span class="html-comment">						&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="188"></td><td class="line-content"><span class="html-comment">						&lt;span class="fragment"&gt;</span></td></tr><tr><td class="line-number" value="189"></td><td class="line-content"><span class="html-comment">						\[\begin{align*}\htmlStyle{visibility:hidden;}{\ln p_{\boldsymbol \theta}(x)} &amp;= \ln \int \frac{p_{\boldsymbol \theta}(\boldsymbol x,\boldsymbol z_{1:T})}{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)}q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)d \boldsymbol z_{1:T} \end{align*}\]</span></td></tr><tr><td class="line-number" value="190"></td><td class="line-content"><span class="html-comment">						&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="191"></td><td class="line-content"><span class="html-comment">						&lt;span class="fragment"&gt;</span></td></tr><tr><td class="line-number" value="192"></td><td class="line-content"><span class="html-comment">						\[\begin{align*}\htmlStyle{visibility:hidden;}{\ln p_{\boldsymbol \theta}(\boldsymbol x)} &amp;= \ln \left (\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \frac{p_{\boldsymbol \theta}(\boldsymbol x,\boldsymbol z_{1:T})}{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)}\right ]\right) \end{align*}\]</span></td></tr><tr><td class="line-number" value="193"></td><td class="line-content"><span class="html-comment">						&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="194"></td><td class="line-content"><span class="html-comment">						&lt;span class="fragment"&gt;</span></td></tr><tr><td class="line-number" value="195"></td><td class="line-content"><span class="html-comment">						\[\begin{align*}\htmlStyle{visibility:hidden;}{\ln p_{\boldsymbol \theta}(\boldsymbol  x)} &amp;\ge  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [\ln \left (\frac{p(\boldsymbol x,\boldsymbol z_{1:T})}{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \right )\right ] \end{align*}\]</span></td></tr><tr><td class="line-number" value="196"></td><td class="line-content"><span class="html-comment">						&lt;/span&gt; --&gt;</span></td></tr><tr><td class="line-number" value="197"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="198"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="199"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="200"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="201"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="202"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="203"></td><td class="line-content">						<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="204"></td><td class="line-content">							<span class="html-comment">&lt;!-- &lt;img class="noborder" style="width:100%" src="hierarchical_vae_1.svg"&gt; --&gt;</span></td></tr><tr><td class="line-number" value="205"></td><td class="line-content">							<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">noborder</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:100%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/week6/hierarchical_vae_2.svg" rel="noreferrer noopener">hierarchical_vae_2.svg</a>"&gt;</span>									</td></tr><tr><td class="line-number" value="206"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="207"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="208"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="209"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="210"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="211"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="212"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Hierarchical VAE (3)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="213"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="214"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="215"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">flex-grow: 2.0;</span>"&gt;</span></td></tr><tr><td class="line-number" value="216"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="217"></td><td class="line-content">							<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border:1px solid lightgrey; font-size:90%</span>"&gt;</span></td></tr><tr><td class="line-number" value="218"></td><td class="line-content">							\[p_{\boldsymbol \theta}(\boldsymbol x, \boldsymbol z_{1:T}) = p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) \prod_{t=1}^{T-1} p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})p_{\boldsymbol \theta}(\boldsymbol z_T)\]</td></tr><tr><td class="line-number" value="219"></td><td class="line-content">							\[q_{\boldsymbol \phi}(\boldsymbol z_{1:T}|\boldsymbol x) = q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x)\prod_{t=2}^{T} q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1})\]</td></tr><tr><td class="line-number" value="220"></td><td class="line-content">							<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="221"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="222"></td><td class="line-content">						<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="223"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="224"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="225"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="226"></td><td class="line-content">						<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="227"></td><td class="line-content">							<span class="html-comment">&lt;!-- &lt;img class="noborder" style="width:100%" src="hierarchical_vae_1.svg"&gt; --&gt;</span></td></tr><tr><td class="line-number" value="228"></td><td class="line-content">							<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">noborder</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:-2em; width:80%;</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/week6/hierarchical_vae_2.svg" rel="noreferrer noopener">hierarchical_vae_2.svg</a>"&gt;</span>									</td></tr><tr><td class="line-number" value="229"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="230"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="231"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="232"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">position:absolute; margin-top:-2em;</span>"&gt;</span></td></tr><tr><td class="line-number" value="233"></td><td class="line-content">					Writing up the ELBO:</td></tr><tr><td class="line-number" value="234"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="235"></td><td class="line-content">					\[\begin{align*}\ln p_{\boldsymbol \theta}(x) &amp;= \ln \int p_{\boldsymbol \theta}(\boldsymbol x,\boldsymbol z_{1:T})d \boldsymbol z_{1:T} = \ln \int \frac{p_{\boldsymbol \theta}(\boldsymbol x,\boldsymbol z_{1:T})}{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)}q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)d \boldsymbol z_{1:T} \end{align*}\]</td></tr><tr><td class="line-number" value="236"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="237"></td><td class="line-content">						\[\begin{align*}\htmlStyle{visibility:hidden;}{\ln p_{\boldsymbol \theta}(x)} &amp;= \ln \left (\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \frac{p_{\boldsymbol \theta}(\boldsymbol x,\boldsymbol z_{1:T})}{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)}\right ]\right) \overbrace{\ge}^\text{Jensen's}  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [\ln \left (\frac{p(\boldsymbol x,\boldsymbol z_{1:T})}{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \right )\right ]\end{align*} \]</td></tr><tr><td class="line-number" value="238"></td><td class="line-content">						<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="239"></td><td class="line-content">						<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="240"></td><td class="line-content">							\[\begin{align*}\htmlStyle{visibility:hidden;}{\ln p_{\boldsymbol \theta}(\boldsymbol  x)} &amp;=  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) + \sum_{t=1}^{T-1} \ln p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1}) + \ln p_{\boldsymbol \theta}(\boldsymbol z_T) \right . \\[-0.5em]</td></tr><tr><td class="line-number" value="241"></td><td class="line-content">							 &amp; \hspace{6em}- \left .\ln q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x) - \sum_{t=2}^{T} \ln q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1}) \right ] \end{align*}\]</td></tr><tr><td class="line-number" value="242"></td><td class="line-content">						<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="243"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span>					</td></tr><tr><td class="line-number" value="244"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="245"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="246"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="247"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Hierarchical VAE (4)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="248"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border:1px solid lightgrey; font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="249"></td><td class="line-content">						\[\begin{align*}\ln p_{\boldsymbol \theta}(\boldsymbol  x) &amp;\ge  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) + \underbrace{\sum_{t=1}^{T-1} \ln p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})}_{\ln p_{\boldsymbol \theta}(\boldsymbol z_1|\boldsymbol z_{2})+\sum_{t=2}^{T-1}\ldots} + \ln p_{\boldsymbol \theta}(\boldsymbol z_T)  - \ln q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x) - \underbrace{\sum_{t=2}^{T} \ln q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1})}_{q_{\boldsymbol \phi}(\boldsymbol z_T|\boldsymbol z_{T-1}) + \sum_{t=2}^{T-1}\ldots} \right ] \end{align*}\]</td></tr><tr><td class="line-number" value="250"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="251"></td><td class="line-content">					After a bit of rewriting: </td></tr><tr><td class="line-number" value="252"></td><td class="line-content">					\[\begin{align*}\ln p_{\boldsymbol \theta}(x) &amp;\ge \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) + \sum_{t=2}^{T-1} \bigl( \ln p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1}) - \ln q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1}) \bigl) \right .\\</td></tr><tr><td class="line-number" value="253"></td><td class="line-content">					&amp; \hspace{6em}\left . + \ln p_{\boldsymbol \theta}(\boldsymbol z_T) - \ln q_{\boldsymbol \phi}(\boldsymbol z_T|\boldsymbol z_{T-1}) + \ln p_{\boldsymbol \theta}(\boldsymbol z_1|\boldsymbol z_{2}) - \ln q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x)</td></tr><tr><td class="line-number" value="254"></td><td class="line-content">					 \right ] \end{align*}\]</td></tr><tr><td class="line-number" value="255"></td><td class="line-content">					 <span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="256"></td><td class="line-content">						\[\begin{align*}\htmlStyle{visibility:hidden;}{\ln p_{\boldsymbol \theta}(\boldsymbol  x)} &amp;=  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) \right ] + \\ </td></tr><tr><td class="line-number" value="257"></td><td class="line-content">						&amp; \hspace{5em} + \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_1|\boldsymbol z_{2})}{q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x)} \right ] + \sum_{t=2}^{T-1} \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})}{q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1})}\right ] \\</td></tr><tr><td class="line-number" value="258"></td><td class="line-content">						&amp; \hspace{5em} + \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_T)}{q_{\boldsymbol \phi}(\boldsymbol z_T|\boldsymbol z_{T-1})} \right ]    </td></tr><tr><td class="line-number" value="259"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="260"></td><td class="line-content">						<span class="html-tag">&lt;/span&gt;</span>				</td></tr><tr><td class="line-number" value="261"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="262"></td><td class="line-content">					These are Kullback-Leibler divergences - but note that to sample from the relevant \(q\) distributions, we must sample the entire Markov chain from \(1 \ldots T\)</td></tr><tr><td class="line-number" value="263"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span>	</td></tr><tr><td class="line-number" value="264"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="265"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="266"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="267"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="268"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Hierarchical VAE (5)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="269"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="270"></td><td class="line-content">					We have written up the ELBO:</td></tr><tr><td class="line-number" value="271"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:90%; border:1px solid lightgrey;</span>"&gt;</span></td></tr><tr><td class="line-number" value="272"></td><td class="line-content">					\[\begin{align*}\ln p_{\boldsymbol \theta}(\boldsymbol  x) &amp;=  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) \right ] + \\ </td></tr><tr><td class="line-number" value="273"></td><td class="line-content">					&amp; \hspace{5em} + \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_1|\boldsymbol z_{2})}{q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x)} \right ] + \sum_{t=2}^{T-1} \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})}{q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1})}\right ] \\</td></tr><tr><td class="line-number" value="274"></td><td class="line-content">					&amp; \hspace{5em} + \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_T)}{q_{\boldsymbol \phi}(\boldsymbol z_T|\boldsymbol z_{T-1})} \right ] </td></tr><tr><td class="line-number" value="275"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="276"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="277"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>However, it turns out to be difficult to estimate \(q_{\boldsymbol \phi}(\boldsymbol z_{1:T}|\boldsymbol x)\) in practice. <span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="278"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="279"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="280"></td><td class="line-content">					Potential solutions:</td></tr><tr><td class="line-number" value="281"></td><td class="line-content">					<span class="html-tag">&lt;ul&gt;</span></td></tr><tr><td class="line-number" value="282"></td><td class="line-content">						<span class="html-tag">&lt;li&gt;</span>Construct smarter \(q(\boldsymbol z_{1:T}|\boldsymbol x)\) structures (e.g. "ladder" VAEs)<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="283"></td><td class="line-content">						<span class="html-tag">&lt;li <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Make our variational distribution <span class="html-tag">&lt;em&gt;</span>parameter-free<span class="html-tag">&lt;/em&gt;</span>: \[q_{\boldsymbol \phi}(\boldsymbol z_{1:T}|\boldsymbol x) = q(\boldsymbol z_{1:T}|\boldsymbol x)\]<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="284"></td><td class="line-content">					<span class="html-tag">&lt;/ul&gt;</span></td></tr><tr><td class="line-number" value="285"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="286"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="287"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="288"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="289"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="290"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="291"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="292"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="293"></td><td class="line-content">					Ideas: <span class="html-tag">&lt;br&gt;</span></td></tr><tr><td class="line-number" value="294"></td><td class="line-content">					<span class="html-tag">&lt;ul&gt;</span></td></tr><tr><td class="line-number" value="295"></td><td class="line-content">						<span class="html-tag">&lt;li&gt;</span>We let all latent variables \(\boldsymbol z_t\) have the same dimension as \(\boldsymbol x\).<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="296"></td><td class="line-content">						<span class="html-tag">&lt;li&gt;</span>We choose \(q(\boldsymbol z_{t}|\boldsymbol z_{t-1})\) to follow a Gaussian diffusion process:</td></tr><tr><td class="line-number" value="297"></td><td class="line-content">\[</td></tr><tr><td class="line-number" value="298"></td><td class="line-content">q(\boldsymbol z_{t}|\boldsymbol z_{t-1}) = \mathcal{N}(\boldsymbol z_t | \sqrt{1-\beta_t}z_{t-1}, \beta_t \mathrm{\bf I}) \hspace{3em}\text{, with } \boldsymbol z_0 = \boldsymbol x</td></tr><tr><td class="line-number" value="299"></td><td class="line-content">\]</td></tr><tr><td class="line-number" value="300"></td><td class="line-content">							<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="301"></td><td class="line-content">					<span class="html-tag">&lt;/ul&gt;</span></td></tr><tr><td class="line-number" value="302"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="303"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="304"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>Note that in each step, we simple scale \(\boldsymbol z_t\) slightly and then add some noise. This is clear when rewriting using the reparameterization trick:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="305"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="306"></td><td class="line-content">						\[\boldsymbol z_t = \sqrt{1-\beta_t}\boldsymbol z_{t-1} + \sqrt{\beta_t}\boldsymbol \epsilon_t \hspace{2em}\text{, where } \boldsymbol \epsilon_t \sim \mathcal{N}(0, \mathrm{\bf I})\]</td></tr><tr><td class="line-number" value="307"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="308"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="309"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="310"></td><td class="line-content">							<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>\(\beta_t\) often just follows some predefined schedule (i.e., not learned).<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="311"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="312"></td><td class="line-content">									</td></tr><tr><td class="line-number" value="313"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="314"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="315"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="316"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="317"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models (2)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="318"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="319"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>To make it clear that all latent variables now live in the data space, we will change notation, and refer to our latent variables as \(\boldsymbol x_{1:T}\), with \(\boldsymbol x_0\) being the data.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="320"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="321"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>This simplifies our expression:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="322"></td><td class="line-content">					</td></tr><tr><td class="line-number" value="323"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border:1px solid lightgrey; font-size:85%</span>"&gt;</span></td></tr><tr><td class="line-number" value="324"></td><td class="line-content">						\[\begin{align*} \underbrace{\ln p_{\boldsymbol \theta}(\boldsymbol  x)}_{\ln p_{\boldsymbol \theta}(\boldsymbol x_0)} &amp;\ge  \underbrace{\mathbb{E}_{q(\boldsymbol z_{1:T} | \boldsymbol x)}}_{\mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)}} \biggl [ \underbrace{\ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1)}_{\ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)} + \underbrace{\ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_1|\boldsymbol z_{2})}{q(\boldsymbol z_1|\boldsymbol x)}  + \sum_{t=2}^{T-1} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})}{q(\boldsymbol z_t|\boldsymbol z_{t-1})}}_{\sum_{t=1}^{T-1} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1})}{q(\boldsymbol x_t|\boldsymbol x_{t-1})}}  + \underbrace{\ln \frac{p_{\boldsymbol \theta}(\boldsymbol z_T)}{q(\boldsymbol z_T|\boldsymbol z_{T-1})}}_{\ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_T)}{q(\boldsymbol x_T|\boldsymbol x_{T-1})}} \biggl ] </td></tr><tr><td class="line-number" value="325"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="326"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="327"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="328"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="329"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>We thus have:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="330"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="331"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:100%; margin-top:-0.5em;</span>"&gt;</span></td></tr><tr><td class="line-number" value="332"></td><td class="line-content">						\[\begin{align*} \ln p_{\boldsymbol \theta}(\boldsymbol x_0) &amp;\ge  \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \biggl [ \ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) + \sum_{t=1}^{T-1} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1})}{q(\boldsymbol x_t|\boldsymbol x_{t-1})}  + \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_T)}{q(\boldsymbol x_T|\boldsymbol x_{T-1})} \biggl ] := \mathcal{L} </td></tr><tr><td class="line-number" value="333"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="334"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="335"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="336"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="337"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="338"></td><td class="line-content">					<span class="html-comment">&lt;!-- &lt;div style="border:1px solid lightgrey; font-size:75%"&gt;</span></td></tr><tr><td class="line-number" value="339"></td><td class="line-content"><span class="html-comment">						\[\begin{align*}\ln p_{\boldsymbol \theta}(\boldsymbol x_0) &amp;=  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)} \biggl [ \ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) \biggl ] + \sum_{t=1}^{T-1} \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1})}{q_{\boldsymbol \phi}(\boldsymbol x_t|\boldsymbol x_{t-1})}\right ]  + \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)} \biggl [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_T)}{q_{\boldsymbol \phi}(\boldsymbol x_T|\boldsymbol x_{T-1})} \biggl ] </span></td></tr><tr><td class="line-number" value="340"></td><td class="line-content"><span class="html-comment">						\end{align*}\]</span></td></tr><tr><td class="line-number" value="341"></td><td class="line-content"><span class="html-comment">					&lt;/div&gt; --&gt;</span></td></tr><tr><td class="line-number" value="342"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="343"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Can we get around having to sample all of \(\boldsymbol x_{1:T}\) each time?<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="344"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="345"></td><td class="line-content">					<span class="html-comment">&lt;!-- &lt;div style="border:1px solid lightgrey; font-size:75%"&gt;</span></td></tr><tr><td class="line-number" value="346"></td><td class="line-content"><span class="html-comment">						\[\begin{align*}\ln \underbrace{p_{\boldsymbol \theta}(\boldsymbol  x)}_{p_{\boldsymbol \theta}(\boldsymbol  x_0)} &amp;\ge  \mathbb{E}_{\underbrace{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)}} \left [ \underbrace{\ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) + \sum_{t=1}^{T-1} \ln p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})}_{\sum_{t=0}^{T-1} \ln p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1}) = \sum_{t=1}^{T} \ln p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})} + \ln \underbrace{p_{\boldsymbol \theta}(\boldsymbol z_T)}_{p_{\boldsymbol \theta}(\boldsymbol x_T)}  - \underbrace{\ln q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x) - \sum_{t=2}^{T} \ln q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1})}_{\sum_{t=1}^{T} \ln q(\boldsymbol x_t|\boldsymbol x_{t-1})} \right ] \end{align*}\]</span></td></tr><tr><td class="line-number" value="347"></td><td class="line-content"><span class="html-comment">					&lt;/div&gt; --&gt;</span></td></tr><tr><td class="line-number" value="348"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="349"></td><td class="line-content">					<span class="html-comment">&lt;!-- &lt;p&gt;We thus have:&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="350"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="351"></td><td class="line-content"><span class="html-comment">					\[\begin{align*}\ln p_{\boldsymbol \theta}(\boldsymbol  x_0) &amp;\ge  \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \sum_{t=1}^{T} \ln p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}) + \ln p_{\boldsymbol \theta}(\boldsymbol x_T)  - \sum_{t=1}^{T} \ln q(\boldsymbol x_{t}|\boldsymbol x_{t-1}) \right ] \\</span></td></tr><tr><td class="line-number" value="352"></td><td class="line-content"><span class="html-comment">					&amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \ln  p_{\boldsymbol \theta}(\boldsymbol x_T) + \sum_{t=1}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{q(\boldsymbol x_{t}|\boldsymbol x_{t-1})}  \right]  := \mathcal{L} </span></td></tr><tr><td class="line-number" value="353"></td><td class="line-content"><span class="html-comment">					\end{align*}\]</span></td></tr><tr><td class="line-number" value="354"></td><td class="line-content"><span class="html-comment"> --&gt;</span></td></tr><tr><td class="line-number" value="355"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="356"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="357"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="358"></td><td class="line-content">				<span class="html-comment">&lt;!-- &lt;section style="font-size:75%"&gt;</span></td></tr><tr><td class="line-number" value="359"></td><td class="line-content"><span class="html-comment">					&lt;h2&gt;Diffusion-based deep generative models (2)&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="360"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="361"></td><td class="line-content"><span class="html-comment">					&lt;p&gt;To make it clear that all latent variables now live in the data space, we will change notation, and refer to our latent variables as \(\boldsymbol x_{1:T}\), with \(\boldsymbol x_0\) being the data.&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="362"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="363"></td><td class="line-content"><span class="html-comment">					&lt;p&gt;This simplifies our notation:&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="364"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="365"></td><td class="line-content"><span class="html-comment">					&lt;div style="border:1px solid lightgrey; font-size:75%"&gt;</span></td></tr><tr><td class="line-number" value="366"></td><td class="line-content"><span class="html-comment">						\[\begin{align*}\ln \underbrace{p_{\boldsymbol \theta}(\boldsymbol  x)}_{p_{\boldsymbol \theta}(\boldsymbol  x_0)} &amp;\ge  \mathbb{E}_{\underbrace{q_{\boldsymbol \phi}(\boldsymbol z_{1:T} | \boldsymbol x)}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)}} \left [ \underbrace{\ln p_{\boldsymbol \theta}(\boldsymbol x|\boldsymbol z_1) + \sum_{t=1}^{T-1} \ln p_{\boldsymbol \theta}(\boldsymbol z_t|\boldsymbol z_{t+1})}_{\sum_{t=0}^{T-1} \ln p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1}) = \sum_{t=1}^{T} \ln p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})} + \ln \underbrace{p_{\boldsymbol \theta}(\boldsymbol z_T)}_{p_{\boldsymbol \theta}(\boldsymbol x_T)}  - \underbrace{\ln q_{\boldsymbol \phi}(\boldsymbol z_1|\boldsymbol x) - \sum_{t=2}^{T} \ln q_{\boldsymbol \phi}(\boldsymbol z_t|\boldsymbol z_{t-1})}_{\sum_{t=1}^{T} \ln q(\boldsymbol x_t|\boldsymbol x_{t-1})} \right ] \end{align*}\]</span></td></tr><tr><td class="line-number" value="367"></td><td class="line-content"><span class="html-comment">					&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="368"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="369"></td><td class="line-content"><span class="html-comment">					&lt;p&gt;We thus have:&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="370"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="371"></td><td class="line-content"><span class="html-comment">					\[\begin{align*}\ln p_{\boldsymbol \theta}(\boldsymbol  x_0) &amp;\ge  \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \sum_{t=1}^{T} \ln p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}) + \ln p_{\boldsymbol \theta}(\boldsymbol x_T)  - \sum_{t=1}^{T} \ln q(\boldsymbol x_{t}|\boldsymbol x_{t-1}) \right ] \\</span></td></tr><tr><td class="line-number" value="372"></td><td class="line-content"><span class="html-comment">					&amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \ln  p_{\boldsymbol \theta}(\boldsymbol x_T) + \sum_{t=1}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{q(\boldsymbol x_{t}|\boldsymbol x_{t-1})}  \right]  := \mathcal{L} </span></td></tr><tr><td class="line-number" value="373"></td><td class="line-content"><span class="html-comment">					\end{align*}\]</span></td></tr><tr><td class="line-number" value="374"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="375"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="376"></td><td class="line-content"><span class="html-comment">				&lt;/section&gt; --&gt;</span></td></tr><tr><td class="line-number" value="377"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="378"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="379"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: trick 1<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="380"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="381"></td><td class="line-content">						The Markov chain \(q(\boldsymbol x_{t}|\boldsymbol x_{t-1}) = \mathcal{N}(\boldsymbol x_t | \sqrt{1-\beta_t}\boldsymbol x_{t-1}, \beta_t \mathrm{\bf I})\), for \(t=1\ldots T\) is an Ornstein-Uhlenbeck process. We therefore know that \(q(\boldsymbol x_{t}|\boldsymbol x_{0})\) can be written as: \(\mathcal{N}(\sqrt{\bar \alpha_t}\boldsymbol x_0, 1-\bar \alpha_t)\), where \(\bar \alpha_t\) can be calculated in closed-form from \(\beta_1\ldots\beta_t\).</td></tr><tr><td class="line-number" value="382"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="383"></td><td class="line-content">							<span class="html-comment">&lt;!-- The outcome of our Markov chain of Gaussian steps, \(q(\boldsymbol x_{t}|\boldsymbol x_{t-1}) = \mathcal{N}(\boldsymbol x_t | \sqrt{1-\beta_t}x_{t-1}, \beta_t \mathrm{\bf I})\), after \(t\) steps, is Gaussian distributed.  --&gt;</span></td></tr><tr><td class="line-number" value="384"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="385"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>We can thus sample from \(\boldsymbol x_t \sim q(\boldsymbol x_t|\boldsymbol x_0)\) in one shot - no need for all of \(q(\boldsymbol x_{1:T})\)!<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="386"></td><td class="line-content">						</td></tr><tr><td class="line-number" value="387"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="388"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="389"></td><td class="line-content">					We can see this by applying the reparamerization trick recursively:</td></tr><tr><td class="line-number" value="390"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="391"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="392"></td><td class="line-content">					\boldsymbol x_t &amp;= \underbrace{\sqrt{1-\beta_t}}_{:=\sqrt{\alpha_t}}\boldsymbol x_{t-1} + \sqrt{\beta_t}\boldsymbol \epsilon_{t-1} \hspace{2em}\text{, where } \boldsymbol \epsilon_{t-1} \sim \mathcal{N}(0, \mathrm{\bf I}) \\</td></tr><tr><td class="line-number" value="393"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="394"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="395"></td><td class="line-content">						\[\begin{align*}\htmlStyle{visibility:hidden;}{\boldsymbol x_t} &amp;= \sqrt{\alpha_t}\left(\sqrt{\alpha_{t-1}}\boldsymbol x_{t-2} +  \sqrt{1-\alpha_{t-1}}\boldsymbol \epsilon_{t-2} \right ) + \sqrt{1-\alpha_t}\boldsymbol \epsilon_{t-1} \\</td></tr><tr><td class="line-number" value="396"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="397"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="398"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="399"></td><td class="line-content">						\[\begin{align*}</td></tr><tr><td class="line-number" value="400"></td><td class="line-content">						\htmlStyle{visibility:hidden;}{\boldsymbol x_t} &amp;= \sqrt{\alpha_t\alpha_{t-1}}\boldsymbol x_{t-2} + \underbrace{\sqrt{\alpha_t(1-\alpha_{t-1})}\boldsymbol \epsilon_{t-2}}_{\mathcal{N}(0, \alpha_t(1-\alpha_{t-1}))} + \underbrace{\sqrt{1-\alpha_t}\boldsymbol \epsilon_{t-1}}_{\mathcal{N}(0, 1-\alpha_t)} \hspace{1.5em}\text{\footnotesize sum of two Gaussians} \\</td></tr><tr><td class="line-number" value="401"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="402"></td><td class="line-content">				<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="403"></td><td class="line-content">				<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="404"></td><td class="line-content">				\[\begin{align*}</td></tr><tr><td class="line-number" value="405"></td><td class="line-content">				\htmlStyle{visibility:hidden;}{\boldsymbol x_t} &amp;= \sqrt{\alpha_t\alpha_{t-1}}\boldsymbol x_{t-2} + \underbrace{\sqrt{\alpha_t(1-\alpha_{t-1}) + 1-\alpha_t}}_{1 - \alpha_t\alpha_{t-1}} \boldsymbol \epsilon_{t-2} \hspace{4.0em}\text{\footnotesize ...summing their variances} \\[-1.5em]</td></tr><tr><td class="line-number" value="406"></td><td class="line-content">					\vdots \\[-0.5em]</td></tr><tr><td class="line-number" value="407"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="408"></td><td class="line-content">				<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="409"></td><td class="line-content">				<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="410"></td><td class="line-content">				\[\begin{align*}</td></tr><tr><td class="line-number" value="411"></td><td class="line-content">				\htmlStyle{visibility:hidden;}{\boldsymbol x_t} &amp;= \underbrace{\sqrt{\alpha_t\alpha_{t-1}\ldots \alpha_{0}}}_{\sqrt{\bar \alpha_t}}\boldsymbol x_{0} + \underbrace{\sqrt{1 - \alpha_t\alpha_{t-1}\ldots\alpha_{0}}}_{\sqrt{1 - \bar \alpha_t}}\boldsymbol \epsilon_0</td></tr><tr><td class="line-number" value="412"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="413"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="414"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="415"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="416"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="417"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: trick 1 (2)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="418"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="419"></td><td class="line-content">					Lets now rewrite our expectations over only the relevant \(\boldsymbol x_t\)</td></tr><tr><td class="line-number" value="420"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="421"></td><td class="line-content">					\[\begin{align*}\mathcal{L}  &amp;=  \underbrace{\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)}}_{\color{red}\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1} | \boldsymbol x_0)}} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) \right ] + </td></tr><tr><td class="line-number" value="422"></td><td class="line-content">					\sum_{t=1}^{T-1} \underbrace{\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)}}_{\color{red}\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{t-1}, \boldsymbol x_{t+1} | \boldsymbol x_0)}} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1})}{q_{\boldsymbol \phi}(\boldsymbol x_t|\boldsymbol x_{t-1})}\right ] \\</td></tr><tr><td class="line-number" value="423"></td><td class="line-content">					&amp; \hspace{5em} + \underbrace{\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)}}_{\color{red}\mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{T-1} | \boldsymbol x_0)}} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_T)}{q_{\boldsymbol \phi}(\boldsymbol x_T|\boldsymbol x_{T-1})} \right ]  </td></tr><tr><td class="line-number" value="424"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="425"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="426"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="427"></td><td class="line-content">					We can consider the sum as an expectation over a uniform distribution of \(t\) values:</td></tr><tr><td class="line-number" value="428"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="429"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:-1em;</span>"&gt;</span></td></tr><tr><td class="line-number" value="430"></td><td class="line-content">					\[\begin{align*}\mathcal{L}  &amp;=  \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1} | \boldsymbol x_0)} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) \right ] + </td></tr><tr><td class="line-number" value="431"></td><td class="line-content">					\overbrace{\sum_{t=1}^{T-1}}^{(T-1)\mathbb{E}_{t\sim\mathcal{U}\{1, T-1\}}} \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{t-1}, \boldsymbol x_{t+1} | \boldsymbol x_0)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1})}{q_{\boldsymbol \phi}(\boldsymbol x_t|\boldsymbol x_{t-1})}\right ] \\</td></tr><tr><td class="line-number" value="432"></td><td class="line-content">					&amp; \hspace{5em} + \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{T-1} | \boldsymbol x_0)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_T)}{q_{\boldsymbol \phi}(\boldsymbol x_T|\boldsymbol x_{T-1})} \right ]  </td></tr><tr><td class="line-number" value="433"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="434"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span>						</td></tr><tr><td class="line-number" value="435"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="436"></td><td class="line-content">					We can thus optimize using stochastic gradients, by sampling a single \(t\) in each optimization step, and then directly sampling from \(q_{\boldsymbol \phi}(\boldsymbol x_{t-1}, \boldsymbol x_{t+1} | \boldsymbol x_0)\). This is an enormous advantage. <span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>But do we really need an \(\mathbb{E}\) over both \(\boldsymbol x_{t-1}\) and \(\boldsymbol x_{t+1}\)?<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="437"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="438"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="439"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="440"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="441"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="442"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="443"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: trick 2<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="444"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="445"></td><td class="line-content">					We can manipulate the ELBO a bit more:</td></tr><tr><td class="line-number" value="446"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="447"></td><td class="line-content">					\[\begin{align*} </td></tr><tr><td class="line-number" value="448"></td><td class="line-content">					\mathcal{L}  &amp;= \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)} \biggl [ \mathrlap{\overbrace{\phantom{\ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) + \sum_{t=1}^{T-1} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1})}{q_{\boldsymbol \phi}(\boldsymbol x_t|\boldsymbol x_{t-1})}}}^{\sum_{t=0}^{T-1} \ln p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1}) = \sum_{t=1}^{T} \ln p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}}\ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) + \underbrace{\sum_{t=1}^{T-1} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_t|\boldsymbol x_{t+1})}{q_{\boldsymbol \phi}(\boldsymbol x_t|\boldsymbol x_{t-1})}  + \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_T)}{q_{\boldsymbol \phi}(\boldsymbol x_T|\boldsymbol x_{T-1})}}_{-\sum_{t=1}^{T}\ln q_{\boldsymbol \phi}(\boldsymbol x_t|\boldsymbol x_{t-1})} \biggl ] \\</td></tr><tr><td class="line-number" value="449"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="450"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="451"></td><td class="line-content">						\[\begin{align*}</td></tr><tr><td class="line-number" value="452"></td><td class="line-content">						\htmlStyle{visibility:hidden;}{\mathcal{L} } &amp; = \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1:T} | \boldsymbol x_0)} \biggl [ \sum_{t=1}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{q_{\boldsymbol \phi}(\boldsymbol x_t|\boldsymbol x_{t-1})} + \ln p_{\boldsymbol \theta}(\boldsymbol x_T) \biggl ] \\</td></tr><tr><td class="line-number" value="453"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="454"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="455"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="456"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="457"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="458"></td><td class="line-content">					\htmlStyle{visibility:hidden;}{\mathcal{L} } &amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)}{q(\boldsymbol x_1|\boldsymbol x_{0})} + \sum_{t=2}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{\color{red}q(\boldsymbol x_{t}|\boldsymbol x_{t-1}, \boldsymbol x_{0})} + \ln p_{\boldsymbol \theta}(\boldsymbol x_T)  \right] \\</td></tr><tr><td class="line-number" value="459"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="460"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="461"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="462"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="463"></td><td class="line-content">						\[\begin{align*}						</td></tr><tr><td class="line-number" value="464"></td><td class="line-content">						\htmlStyle{visibility:hidden;}{\mathcal{L} } &amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)}{q(\boldsymbol x_1|\boldsymbol x_{0})} + \sum_{t=2}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{\color{red}q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})}\frac{\color{red}q(\boldsymbol x_{t-1}|\boldsymbol x_{0})}{\color{red}q(\boldsymbol x_{t} | \boldsymbol x_{0})} + \ln p_{\boldsymbol \theta}(\boldsymbol x_T)    \right] \\[-3em]</td></tr><tr><td class="line-number" value="465"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="466"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="467"></td><td class="line-content">					<span class="html-tag">&lt;a <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:right; margin-top:-3em</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement.parentElement).find('div.popup').toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-q</span>"&gt;</span>?<span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="468"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup</span>"&gt;</span></td></tr><tr><td class="line-number" value="469"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement).toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-close</span>"&gt;</span>×<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="470"></td><td class="line-content">						Bayes' rule:</td></tr><tr><td class="line-number" value="471"></td><td class="line-content">							\[q(\boldsymbol x_{t}|\boldsymbol x_{t-1}, \boldsymbol x_{0}) = \frac{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})q(\boldsymbol x_{t} | \boldsymbol x_{0})}{q(\boldsymbol x_{t-1}|\boldsymbol x_{0})}\]</td></tr><tr><td class="line-number" value="472"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="473"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="474"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="475"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="476"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="477"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="478"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="479"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: trick 2 (2)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="480"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="481"></td><td class="line-content">					<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="482"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border: 1px solid lightgrey</span>"&gt;</span></td></tr><tr><td class="line-number" value="483"></td><td class="line-content">						\[\begin{align*} </td></tr><tr><td class="line-number" value="484"></td><td class="line-content">						\mathcal{L}  &amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \left [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)}{q(\boldsymbol x_1|\boldsymbol x_{0})} + \sum_{t=2}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})}\frac{q(\boldsymbol x_{t-1}|\boldsymbol x_{0})}{q(\boldsymbol x_{t} | \boldsymbol x_{0})} + \ln p_{\boldsymbol \theta}(\boldsymbol x_T)    \right] \\</td></tr><tr><td class="line-number" value="485"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="486"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="487"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="488"></td><td class="line-content">						<span class="html-tag">&lt;span&gt;</span></td></tr><tr><td class="line-number" value="489"></td><td class="line-content">							\[\begin{align*}						</td></tr><tr><td class="line-number" value="490"></td><td class="line-content">							\htmlStyle{visibility:hidden;}{\mathcal{L} } &amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \Biggl [ \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)}{q(\boldsymbol x_1|\boldsymbol x_{0})} + \sum_{t=2}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})} + \underbrace{\sum_{t=2}^{T} \ln \frac{q(\boldsymbol x_{t-1}|\boldsymbol x_{0})}{q(\boldsymbol x_{t} | \boldsymbol x_{0})}}_{\substack{\ln q(\boldsymbol x_1|\boldsymbol x_{0}) - \sout{\ln q(\boldsymbol x_2|\boldsymbol x_{0})} + \\  \sout{\ln q(\boldsymbol x_2|\boldsymbol x_{0})} - \ln q(\boldsymbol x_3|\boldsymbol x_{0}) + \ldots \\ = \hspace{0.5em}\ln q(\boldsymbol x_1|\boldsymbol x_{0}) - \ln q(\boldsymbol x_T|\boldsymbol x_{0})}} + \ln p_{\boldsymbol \theta}(\boldsymbol x_T)   \Biggl ] \\</td></tr><tr><td class="line-number" value="491"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="492"></td><td class="line-content">						<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="493"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="494"></td><td class="line-content">					    </td></tr><tr><td class="line-number" value="495"></td><td class="line-content">						<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="496"></td><td class="line-content">							\[\begin{align*}						</td></tr><tr><td class="line-number" value="497"></td><td class="line-content">							\htmlStyle{visibility:hidden;}{\mathcal{L} } &amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \Biggl [ \ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) + \sum_{t=2}^{T} \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})} + \ln \frac{p_{\boldsymbol \theta}(\boldsymbol x_T)}{q(\boldsymbol x_T|\boldsymbol x_{0})} \Biggl ] \\</td></tr><tr><td class="line-number" value="498"></td><td class="line-content">							\end{align*}\]</td></tr><tr><td class="line-number" value="499"></td><td class="line-content">						<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="500"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="501"></td><td class="line-content">						<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="502"></td><td class="line-content">							\[\begin{align*}						</td></tr><tr><td class="line-number" value="503"></td><td class="line-content">							\htmlStyle{visibility:hidden;}{\mathcal{L} } &amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \Biggl [ \underbrace{\ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)}_{\mathcal{L}_0} - \sum_{t=2}^{T} \underbrace{\text{KL}(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0}) || p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}))}_{\mathcal{L}_{t-1}} - \underbrace{\text{KL}(q(\boldsymbol x_T|\boldsymbol x_{0}) || p_{\boldsymbol \theta}(\boldsymbol x_T))}_{\mathcal{L}_T} \Biggl ]</td></tr><tr><td class="line-number" value="504"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="505"></td><td class="line-content">						<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="506"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span>						</td></tr><tr><td class="line-number" value="507"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="508"></td><td class="line-content">						<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>This is how the training objective is most commonly presented.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="509"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="510"></td><td class="line-content">						<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>But can we actually evaluate \(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})\)?<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="511"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="512"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="513"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="514"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:65%</span>"&gt;</span></td></tr><tr><td class="line-number" value="515"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: \(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})\)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="516"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="517"></td><td class="line-content">					\[\begin{align*}q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0}) &amp;= \frac{q(\boldsymbol x_{t}|\boldsymbol x_{t-1}, \boldsymbol x_{0})q(\boldsymbol x_{t-1}|\boldsymbol x_{0})}{q(\boldsymbol x_{t} | \boldsymbol x_{0})} </td></tr><tr><td class="line-number" value="518"></td><td class="line-content">					\propto \mathcal{N}(\sqrt{\alpha_{t}}\boldsymbol x_{t-1}, 1- \alpha_{t})\mathcal{N}(\sqrt{\bar \alpha_{t-1}}\boldsymbol x_0, 1-\bar \alpha_{t-1})</td></tr><tr><td class="line-number" value="519"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="520"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="521"></td><td class="line-content">					<span class="html-tag">&lt;a <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:right; margin-top:-3.5em</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement.parentElement).find('div#popup1').toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-q</span>"&gt;</span>?<span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="522"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">popup1</span>"&gt;</span></td></tr><tr><td class="line-number" value="523"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement).toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-close</span>"&gt;</span>×<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="524"></td><td class="line-content">						The denominator \(\mathcal{N}(\sqrt{\bar \alpha_{t}}\boldsymbol x_0, 1-\bar \alpha_{t})\) is just a constant in \(x_{t-1}\)</td></tr><tr><td class="line-number" value="525"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="526"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="527"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="528"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="529"></td><td class="line-content">					\htmlStyle{visibility:hidden;}{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})} &amp;\propto \exp \left ( \frac{1}{2} \left ( \frac{(\boldsymbol x_t - \sqrt{\alpha_{t}}\boldsymbol x_{t-1})^2}{1-\alpha_{t}} + \frac{(\boldsymbol x_{t-1} - \bar \alpha_{t-1}\boldsymbol x_0)^2}{1-\bar \alpha_{t-1}} \right ) \right) \\</td></tr><tr><td class="line-number" value="530"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="531"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="532"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="533"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="534"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="535"></td><td class="line-content">					\htmlStyle{visibility:hidden;}{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})} &amp;= \exp \left ( \frac{1}{2} \left ( \frac{\boldsymbol x^2_t + \alpha_{t}\boldsymbol x^2_{t-1} - 2 \sqrt{\alpha_t} \boldsymbol x_t\boldsymbol x_{t-1}}{1-\alpha_{t}} + \frac{(\boldsymbol x^2_{t-1} + \bar \alpha_{t-1}\boldsymbol x^2_0 - 2 \sqrt{\bar \alpha_{t-1}}\boldsymbol x_{t-1}\boldsymbol x_0)}{1-\bar \alpha_{t-1}} \right) \right) \\</td></tr><tr><td class="line-number" value="536"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="537"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="538"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="539"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="540"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="541"></td><td class="line-content">					\htmlStyle{visibility:hidden;}{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})} &amp;= \exp \biggl ( \frac{1}{2} \biggl ( \underbrace{ \biggl ( \frac{\alpha_{t}}{1-\alpha_{t}} + \frac{1}{1-\bar \alpha_{t-1}} \biggl )}_{:=a}\boldsymbol x^2_{t-1} - \underbrace{\biggl ( \frac{2 \sqrt{\alpha_t} \boldsymbol x_t}{1 - \alpha_t} + \frac{2 \sqrt{\bar \alpha_{t-1}}\boldsymbol x_0}{1-\bar \alpha_{t-1}}\biggl )}_{:=b} \boldsymbol x_{t-1}  + C_1 \biggl ) \biggl ) \\[-.5em]</td></tr><tr><td class="line-number" value="542"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="543"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="544"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="545"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:-0.75em</span>"&gt;</span></td></tr><tr><td class="line-number" value="546"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="547"></td><td class="line-content">					\htmlStyle{visibility:hidden;}{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})}&amp;= \exp \left ( \frac{1}{2} \left ( a \left (\boldsymbol x_{t-1} - \frac{b}{2a}\right)^2 + C_2 \right ) \right )</td></tr><tr><td class="line-number" value="548"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="549"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="550"></td><td class="line-content">					<span class="html-tag">&lt;a <span class="html-attribute-name">style</span>="<span class="html-attribute-value">float:right; margin-top:-3.5em</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement.parentElement).find('div#popup2').toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-q</span>"&gt;</span>?<span class="html-tag">&lt;/a&gt;</span></td></tr><tr><td class="line-number" value="551"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup</span>" <span class="html-attribute-name">id</span>="<span class="html-attribute-value">popup2</span>"&gt;</span></td></tr><tr><td class="line-number" value="552"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement).toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-close</span>"&gt;</span>×<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="553"></td><td class="line-content">						\(C_1\) and \(C_2\) are just constants that do not depend on \(x_{t-1}\)</td></tr><tr><td class="line-number" value="554"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="555"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="556"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="557"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:100%; margin-top:-0.1em;</span>"&gt;</span></td></tr><tr><td class="line-number" value="558"></td><td class="line-content">						We recognize this as a Gaussian \(\mathcal{N}(\boldsymbol x_{t-1} | \tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t), \tilde \beta_t \mathrm{\bf I})\) with:						</td></tr><tr><td class="line-number" value="559"></td><td class="line-content">					<span class="html-tag">&lt;span &gt;</span></td></tr><tr><td class="line-number" value="560"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="561"></td><td class="line-content">					\hspace{3em}\tilde \beta_t &amp;= \frac{1}{a} = \left ( \frac{\alpha_{t}}{1-\alpha_{t}} + \frac{1}{1-\bar \alpha_{t-1}} \right )^{-1} = \left ( \frac{\alpha_{t}(1-\bar \alpha_{t-1}) + 1-\alpha_{t}}{(1-\alpha_{t})(1-\bar \alpha_{t-1})} \right)^{-1} \\ </td></tr><tr><td class="line-number" value="562"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="563"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="564"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:-0.2em</span>"&gt;</span></td></tr><tr><td class="line-number" value="565"></td><td class="line-content">						\[\begin{align*}</td></tr><tr><td class="line-number" value="566"></td><td class="line-content">						\htmlStyle{visibility:hidden;}{\tilde \beta_t \hspace{3em}} &amp;= \biggl (\frac{1-\color{red}\alpha_{t}\bar \alpha_{t-1}}{{\color{blue}(1-\alpha_{t})}(1-\bar \alpha_{t-1})} \biggl )^{-1} = \frac{1-\bar \alpha_{t-1}}{1-\color{red}\bar \alpha_{t}}\color{blue}\beta_t \\</td></tr><tr><td class="line-number" value="567"></td><td class="line-content">						\end{align*}\]</td></tr><tr><td class="line-number" value="568"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="569"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:-0.2em</span>"&gt;</span></td></tr><tr><td class="line-number" value="570"></td><td class="line-content">						\[\begin{align*}</td></tr><tr><td class="line-number" value="571"></td><td class="line-content">						\tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t) &amp;= \frac{b}{2a} = \left (\frac{\sqrt{\alpha_t} }{1 - \alpha_t}\boldsymbol x_t + \frac{\sqrt{\bar \alpha_{t-1}}}{1-\bar \alpha_{t-1}}\boldsymbol x_0 \right )\tilde\beta_t = \left (\frac{\sqrt{\alpha_t} (1-\bar \alpha_{t-1})}{(1-\bar \alpha_{t})}\boldsymbol x_t + \frac{\sqrt{\bar \alpha_{t-1}}\beta_t}{1-\bar \alpha_{t}}\boldsymbol x_0 \right )</td></tr><tr><td class="line-number" value="572"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="573"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="574"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="575"></td><td class="line-content"><span class="html-comment">&lt;!-- </span></td></tr><tr><td class="line-number" value="576"></td><td class="line-content"><span class="html-comment">					&amp;= \exp \biggl ( \frac{1}{2} \biggl ( \underbrace{\biggl ( \frac{\alpha_{t}}{1-\alpha_{t}} + \frac{1}{1-\bar \alpha_{t-1}} \biggl )}_{\frac{\alpha_{t}(1-\bar \alpha_{t-1}) + 1-\alpha_{t}}{(1-\alpha_{t})(1-\bar \alpha_{t-1})} = \frac{1-\overbrace{\alpha_{t}\bar \alpha_{t-1}}^{\alpha_{t}}}{(1-\alpha_{t})(1-\bar \alpha_{t-1})}=:\tilde \beta}\boldsymbol x^2_{t-1} + \left ( \frac{-2 \sqrt{\alpha_t} \boldsymbol x_t}{1 - \alpha_t} - \frac{2 \sqrt{\bar \alpha_{t-1}}\boldsymbol x_0}{1-\bar \alpha_{t-1}}\biggl ) \boldsymbol x_{t-1}  + C \right ) \biggl ) \\</span></td></tr><tr><td class="line-number" value="577"></td><td class="line-content"><span class="html-comment">					&amp;= \exp \biggl ( \frac{1}{2} \biggl ( \biggl ( \frac{1-\alpha_{t}\bar \alpha_{t-1}}{(1-\alpha_{t})(1-\bar \alpha_{t-1})} \biggl )\boldsymbol x^2_{t-1} + \left ( \frac{-2 \sqrt{\alpha_t} \boldsymbol x_t}{1 - \alpha_t} - \frac{2 \sqrt{\bar \alpha_{t-1}}\boldsymbol x_0}{1-\bar \alpha_{t-1}}\right ) \boldsymbol x_{t-1}  + C \biggl ) \biggl ) \\ --&gt;</span></td></tr><tr><td class="line-number" value="578"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="579"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="580"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="581"></td><td class="line-content">					<span class="html-comment">&lt;!-- &amp;\propto \frac{\mathcal{N}(\sqrt{\alpha_{t}}\boldsymbol x_{t-1}, 1-\bar \alpha_{t})\mathcal{N}(\sqrt{\bar \alpha_{t-1}}\boldsymbol x_0, 1-\bar \alpha_{t-1})}{\mathcal{N}(\sqrt{\bar \alpha_{t}}\boldsymbol x_0, 1-\bar \alpha_{t})}</span></td></tr><tr><td class="line-number" value="582"></td><td class="line-content"><span class="html-comment">					\end{align*}\] --&gt;</span></td></tr><tr><td class="line-number" value="583"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="584"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="585"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="586"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:65%</span>"&gt;</span></td></tr><tr><td class="line-number" value="587"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: \(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})\) (2)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="588"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="589"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="590"></td><td class="line-content">						<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="591"></td><td class="line-content">							We have established that:</td></tr><tr><td class="line-number" value="592"></td><td class="line-content">							\[q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0}) = \mathcal{N}(\boldsymbol x_{t-1} | \tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t), \tilde \beta_t \mathrm{\bm I})\]		</td></tr><tr><td class="line-number" value="593"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="594"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:0.5em;</span>"&gt;</span></td></tr><tr><td class="line-number" value="595"></td><td class="line-content">							<span class="html-tag">&lt;span&gt;</span></td></tr><tr><td class="line-number" value="596"></td><td class="line-content">								\[\begin{align*}\tilde\beta_t &amp;= \biggl (\frac{1-\bar \alpha_{t}}{(1-\alpha_{t})(1-\bar \alpha_{t-1})} \biggl )^{-1} = \frac{1-\bar \alpha_{t-1}}{1-\bar \alpha_{t}}\beta_t \\</td></tr><tr><td class="line-number" value="597"></td><td class="line-content">								\tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t) &amp;= \left (\frac{\sqrt{\alpha_t} (1-\bar \alpha_{t-1})}{1-\bar \alpha_{t}}\boldsymbol x_t + \frac{\color{blue}\sqrt{\bar \alpha_{t-1}}\beta_t}{\color{blue}1-\bar \alpha_{t}}\boldsymbol x_0 \right )</td></tr><tr><td class="line-number" value="598"></td><td class="line-content">								\end{align*}\]</td></tr><tr><td class="line-number" value="599"></td><td class="line-content">								<span class="html-tag">&lt;/span&gt;</span>		</td></tr><tr><td class="line-number" value="600"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="601"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="602"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="603"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="604"></td><td class="line-content">					We also know that \(\boldsymbol x_t\) is a function of \(\boldsymbol x_0\) and the \(\mathcal{N}(0,\mathrm{\bm I})\) sample \(\boldsymbol \epsilon_t\) </td></tr><tr><td class="line-number" value="605"></td><td class="line-content">					\[\boldsymbol x_t(\boldsymbol x_0, \boldsymbol \epsilon_t) = \sqrt{\bar \alpha_t} \boldsymbol x_0 + \sqrt{1-\bar \alpha_t}\boldsymbol \epsilon_t \hspace{1em}\Rightarrow\hspace{1em} \boldsymbol x_0(\boldsymbol x_t, \boldsymbol \epsilon_t) = {\color{red}\frac{1}{\sqrt{\bar \alpha_t}}}\left(\boldsymbol x_t - \sqrt{1-\bar \alpha_t}\boldsymbol \epsilon_t \right)</td></tr><tr><td class="line-number" value="606"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="607"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="608"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="609"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="610"></td><td class="line-content">						We can therefore choose to express \(\tilde {\boldsymbol \mu}\) purely in terms of \(\boldsymbol x_t\) and \(\boldsymbol \epsilon_t\):</td></tr><tr><td class="line-number" value="611"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="612"></td><td class="line-content">					\tilde {\boldsymbol \mu}(\boldsymbol \epsilon_t, \boldsymbol x_t) &amp;= \Biggl (\underbrace{\frac{\sqrt{\alpha_t} (1-\bar \alpha_{t-1})}{1-\bar \alpha_{t}}}_{\frac{1}{\sqrt{\alpha_t}}\frac{\alpha_t (1 - \bar \alpha_{t-1})}{1-\bar \alpha_{t}}}\boldsymbol x_t + \underbrace{\frac{\color{blue}\sqrt{\bar \alpha_{t-1}}}{\color{red}\sqrt{\bar \alpha_t}}}_{\frac{1}{\sqrt{\alpha_t}}}\frac{\color{blue}\beta_t}{\color{blue}1-\bar \alpha_{t}} \boldsymbol x_t - \underbrace{\frac{\color{blue}\sqrt{\bar \alpha_{t-1}}}{\color{red}\sqrt{\bar \alpha_t}}}_{\frac{1}{\sqrt{\alpha_t}}}\frac{\color{blue}\beta_t}{\color{blue}1-\bar \alpha_{t}}\sqrt{1-\bar \alpha_t} \boldsymbol \epsilon_t \Biggl) \\</td></tr><tr><td class="line-number" value="613"></td><td class="line-content">					&amp;= \frac{1}{\sqrt{\alpha_t}} \Biggl ( \underbrace{\frac{\overbrace{\alpha_t(1-\bar \alpha_{t-1})}^{\alpha_t - \bar \alpha_{t}} + \overbrace{\beta_t}^{1 - \alpha_t}}{1-\bar \alpha_{t}} }_{=1}\boldsymbol x_t - \frac{1-\alpha_t}{\sqrt{1-\bar \alpha_t}} \boldsymbol \epsilon_t \Biggl ) = \frac{1}{\sqrt{\alpha_t}} \Biggl (\boldsymbol x_t - \frac{1-\alpha_t}{\sqrt{1-\bar \alpha_t}} \boldsymbol \epsilon_t \Biggl)</td></tr><tr><td class="line-number" value="614"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="615"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="616"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="617"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Why would you want to do this? We'll see in a few slides.<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="618"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="619"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="620"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="621"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: interpretation<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="622"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="623"></td><td class="line-content">					\[\begin{align*} \mathcal{L} &amp;= \mathbb{E}_{q(\boldsymbol x_{1:T} | \boldsymbol x_0)} \Biggl [ \underbrace{\ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)}_{\mathcal{L}_0} - \sum_{t=2}^{T} \underbrace{\text{KL}(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0}) || p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}))}_{\mathcal{L}_{t-1}} - \underbrace{\text{KL}(q(\boldsymbol x_T|\boldsymbol x_{0}) || p_{\boldsymbol \theta}(\boldsymbol x_T))}_{\mathcal{L}_T} \Biggl ]</td></tr><tr><td class="line-number" value="624"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="625"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="626"></td><td class="line-content">					<span class="html-tag">&lt;dl&gt;</span></td></tr><tr><td class="line-number" value="627"></td><td class="line-content">						<span class="html-tag">&lt;dt&gt;</span>\(\mathcal{L}_0\)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="628"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span>Final reconstruction layer. Sometimes treated separately (e.g. to convert from continuous Gaussians to discrete pixel values).<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="629"></td><td class="line-content">						<span class="html-tag">&lt;dt&gt;</span>\(\mathcal{L}_T\)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="630"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span>Typically discarded, since \(p(\boldsymbol x_T)\) is Gaussian noise and \(q(\boldsymbol x_T|\boldsymbol x_{0})\) has no trainable parameters.<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="631"></td><td class="line-content">						<span class="html-tag">&lt;dt&gt;</span>\(\mathcal{L}_{t-1}\)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="632"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span></td></tr><tr><td class="line-number" value="633"></td><td class="line-content">							This minimizes the difference between \(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})\), which is tractable <span class="html-tag">&lt;em&gt;</span>because we condition on <span class="html-tag">&lt;/em&gt;</span>\(\boldsymbol x_0\) 							</td></tr><tr><td class="line-number" value="634"></td><td class="line-content">							and the unconditional \(p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)\) which we cannot write up in closed form (and must therefore fit).</td></tr><tr><td class="line-number" value="635"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="636"></td><td class="line-content">					<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="637"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="638"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="639"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="640"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="641"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Diffusion-based deep generative models: design choices<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="642"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="643"></td><td class="line-content">					<span class="html-tag">&lt;dl&gt;</span></td></tr><tr><td class="line-number" value="644"></td><td class="line-content">						<span class="html-tag">&lt;dt&gt;</span>Variances of forward model variances \(\beta_t\)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="645"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span>Typically set to some fixed schedule, typically increasing as a function of \(t\) (e.g. linearly).<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="646"></td><td class="line-content">						<span class="html-tag">&lt;dt <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:1em;</span>"&gt;</span>Parameterization of \(p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_t)\)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="647"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span>Since we are minimizing \(\text{KL}(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0}) || p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}))\) and \(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})\) is Gaussian, it makes sense to choose a Gaussian: \[p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}) = \mathcal{N}(\boldsymbol x_{t-1} | \boldsymbol \mu(\boldsymbol x_{t}, t), \boldsymbol \Sigma(\boldsymbol x_{t}, t))\]  </td></tr><tr><td class="line-number" value="648"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="649"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>How how should we parameterize \(\boldsymbol \mu(\boldsymbol x_{t}, t)\) and \(\boldsymbol \Sigma(\boldsymbol x_{t}, t)\)?<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="650"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="651"></td><td class="line-content">							<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="652"></td><td class="line-content">							Typical choice: \(\boldsymbol \Sigma(\boldsymbol x_{t}, t) = \sigma^2_t\mathrm{\bf I}\). For \(\sigma_t\), Ho et al, 2020 propose either:</td></tr><tr><td class="line-number" value="653"></td><td class="line-content">								<span class="html-tag">&lt;dl&gt;</span></td></tr><tr><td class="line-number" value="654"></td><td class="line-content">									<span class="html-tag">&lt;dt&gt;</span>\(\sigma^2_t=\beta_t\)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="655"></td><td class="line-content">									<span class="html-tag">&lt;dd&gt;</span>same variance as the forward direction<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="656"></td><td class="line-content">									<span class="html-tag">&lt;dt&gt;</span>\(\sigma^2_t=\tilde \beta_t = \frac{1-\bar \alpha_{t-1}}{1-\bar \alpha_{t}}\beta_t\)<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="657"></td><td class="line-content">									<span class="html-tag">&lt;dd&gt;</span>Variance from \(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})\)<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="658"></td><td class="line-content">								<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="659"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="660"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>So we are left with \(\boldsymbol \mu_\theta(\boldsymbol x_{t}, t)\). <span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="661"></td><td class="line-content">							<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="662"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="663"></td><td class="line-content">					<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="664"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="665"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="666"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="667"></td><td class="line-content">					<span class="html-tag">&lt;h3&gt;</span>Diffusion-based deep generative models: predicting \(\tilde {\boldsymbol \mu}\) <span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="668"></td><td class="line-content">						<span class="html-comment">&lt;!-- \(\boldsymbol \mu_\theta(\boldsymbol x_{t}, t)\)&lt;/h3&gt; --&gt;</span></td></tr><tr><td class="line-number" value="669"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="670"></td><td class="line-content">					The KL between two Gaussians has a closed form expression:</td></tr><tr><td class="line-number" value="671"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="672"></td><td class="line-content">					\mathcal{L}_{t-1} &amp;= \mathbb{E}_{q(\boldsymbol x_{t} | \boldsymbol x_0)} \biggl [ \text{KL}(\underbrace{\mathcal{N}(\boldsymbol x_{t-1} | \tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t), \tilde \beta_t \mathrm{\bf I})}_{q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0})} || \underbrace{\mathcal{N}(\boldsymbol x_{t-1} | \boldsymbol \mu_\theta(\boldsymbol x_t), \sigma_t \mathrm{\bf I})}_{p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t})}) \biggl ] \\</td></tr><tr><td class="line-number" value="673"></td><td class="line-content">					&amp;= \mathbb{E}_{q(\boldsymbol x_{t} | \boldsymbol x_0)} \biggl [ \ln \frac{\sigma_t}{\tilde \beta_t} + \frac{\tilde \beta_t^2 +  \left\lVert \tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t) - \boldsymbol \mu_\theta(\boldsymbol x_t, t)\right\lVert^2}{2\sigma^2_t} \biggl ] \\</td></tr><tr><td class="line-number" value="674"></td><td class="line-content">					&amp;= \mathbb{E}_{q(\boldsymbol x_{t} | \boldsymbol x_0)} \biggl [ \frac{\left\lVert \tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t) - \boldsymbol \mu_\theta(\boldsymbol x_t, t)\right\lVert^2}{2\sigma^2_t} \biggl ] + C</td></tr><tr><td class="line-number" value="675"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="676"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="677"></td><td class="line-content">					With fixed \(\beta_t\), the training objective is thus just a simple MSE-type loss encouraging the learned \(\boldsymbol \mu_\theta(\boldsymbol x_t, t)\) to be as close as possible to \(\tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t)\), but doing so without the luxury of knowing \(\boldsymbol x_0\).</td></tr><tr><td class="line-number" value="678"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="679"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="680"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="681"></td><td class="line-content">				<span class="html-comment">&lt;!-- &lt;section style="font-size:85%"&gt;</span></td></tr><tr><td class="line-number" value="682"></td><td class="line-content"><span class="html-comment">					&lt;h3&gt;Setting \(p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1)\) to \(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \hat {\boldsymbol x}_{0})\)&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="683"></td><td class="line-content"><span class="html-comment"><br></span></td></tr><tr><td class="line-number" value="684"></td><td class="line-content"><span class="html-comment">					Since we are trying to minimize \(\text{KL}(q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \boldsymbol x_{0}) || p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}))\), we can also choose to set </span></td></tr><tr><td class="line-number" value="685"></td><td class="line-content"><span class="html-comment">						\[p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_{t}) = q(\boldsymbol x_{t-1} | \boldsymbol x_{t}, \hat {\boldsymbol x}_{0})\]</span></td></tr><tr><td class="line-number" value="686"></td><td class="line-content"><span class="html-comment">					where \(\hat {\boldsymbol x}_{0}\) is our estimate for the noise-free input \(\boldsymbol x_{0}\).  </span></td></tr><tr><td class="line-number" value="687"></td><td class="line-content"><span class="html-comment">				&lt;/section&gt; --&gt;</span></td></tr><tr><td class="line-number" value="688"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="689"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:65%</span>"&gt;</span></td></tr><tr><td class="line-number" value="690"></td><td class="line-content">					<span class="html-tag">&lt;h3&gt;</span>Diffusion-based deep generative models: predicting \(\boldsymbol \epsilon\) <span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="691"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="692"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>By reparameterizing the objective in terms of \(\boldsymbol \epsilon\), we can gain a few additional insights. We plug in our expression for \(\tilde {\boldsymbol \mu}(\boldsymbol \epsilon_t, \boldsymbol x_t) = \tilde {\boldsymbol \mu}(\boldsymbol x_0(\boldsymbol x_t, \boldsymbol \epsilon_t), \boldsymbol x_t)\):<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="693"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="694"></td><td class="line-content">					\mathcal{L}_{t-1} - C &amp;= \mathbb{E}_{q(\boldsymbol x_{t} | \boldsymbol x_0)} \biggl [ \frac{\left\lVert \tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t) - \boldsymbol \mu_\theta(\boldsymbol x_t, t)\right\lVert^2}{2\sigma^2_t} \biggl ] \\</td></tr><tr><td class="line-number" value="695"></td><td class="line-content">					&amp;= \frac{1}{2\sigma^2_t}\mathbb{E}_{\color{red}{\boldsymbol \epsilon_t \sim \mathcal{N}(0, \mathrm{\bm I})}} \left [ \left\lVert \frac{1}{\sqrt{\alpha_t}} \Biggl (\boldsymbol x_t{\color{red}(\boldsymbol x_0, \boldsymbol \epsilon_t)} - \frac{1-\alpha_t}{\sqrt{1-\bar \alpha_t}} \boldsymbol \epsilon_t \Biggl) - \boldsymbol \mu_\theta(\boldsymbol x_t{\color{red}(\boldsymbol x_0, \boldsymbol \epsilon_t)}, t)\right\lVert^2 \right]</td></tr><tr><td class="line-number" value="696"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="697"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="698"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="699"></td><td class="line-content">					We can now choose to parameterize \(\boldsymbol \mu_\theta(\boldsymbol x_t, t)\) in the same way as \(\tilde {\boldsymbol \mu}(\boldsymbol x_0, \boldsymbol x_t)\), but instead of \(\boldsymbol \epsilon\) using a learned value \(\boldsymbol \epsilon_\theta(\boldsymbol x_t, t)\): </td></tr><tr><td class="line-number" value="700"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="701"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="702"></td><td class="line-content">					\mathcal{L}_{t-1} - C = \frac{1}{2\sigma^2_t}\mathbb{E}_{\boldsymbol \epsilon_t \sim \mathcal{N}(0, \mathrm{\bm I})} \Biggl [ \Biggl\lVert&amp; \frac{1}{\sqrt{\alpha_t}} \Biggl (\boldsymbol x_t(\boldsymbol x_0, \boldsymbol \epsilon_t) - \frac{1-\alpha_t}{\sqrt{1-\bar \alpha_t}} \boldsymbol \epsilon_t \Biggl) - \\</td></tr><tr><td class="line-number" value="703"></td><td class="line-content">					&amp;\frac{1}{\sqrt{\alpha_t}} \Biggl (\boldsymbol x_t(\boldsymbol x_0, \boldsymbol \epsilon_t) - \frac{1-\alpha_t}{\sqrt{1-\bar \alpha_t}} \boldsymbol \epsilon_\theta(\boldsymbol x_t(\boldsymbol x_0, \boldsymbol \epsilon_t), t) \Biggl)\Biggl\lVert^2 \Biggl]</td></tr><tr><td class="line-number" value="704"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="705"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="706"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment custom semi</span>"&gt;</span></td></tr><tr><td class="line-number" value="707"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="708"></td><td class="line-content">					\htmlStyle{visibility:hidden;}{\mathcal{L}_{t-1} - C} &amp;= \frac{1}{2\sigma^2_t}\frac{1}{\alpha_t}\frac{(1-\alpha_t)^2}{1-\bar \alpha_t}\mathbb{E}_{\boldsymbol \epsilon_t \sim \mathcal{N}(0, \mathrm{\bm I})} \left[ \left\lVert  \boldsymbol \epsilon_t  - \boldsymbol \epsilon_\theta(\boldsymbol x_t(\boldsymbol x_0, \boldsymbol \epsilon_t), t)\right\lVert^2 \right] \\</td></tr><tr><td class="line-number" value="709"></td><td class="line-content">					&amp; = \frac{\beta_t^2}{2\sigma^2_t\alpha_t(1-\bar \alpha_t)}\mathbb{E}_{\boldsymbol \epsilon_t \sim \mathcal{N}(0, \mathrm{\bm I})} \left[ \left\lVert  \boldsymbol \epsilon_t  - \boldsymbol \epsilon_\theta(\sqrt{\bar \alpha_t} \boldsymbol x_0 + \sqrt{1-\bar \alpha_t}\boldsymbol \epsilon_t, t)\right\lVert^2 \right]</td></tr><tr><td class="line-number" value="710"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="711"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="712"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="713"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="714"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="715"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="716"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="717"></td><td class="line-content">					<span class="html-tag">&lt;h3&gt;</span>Diffusion-based deep generative models: predicting \(\boldsymbol \epsilon\) (2) <span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="718"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="719"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border:1px solid lightgrey</span>"&gt;</span></td></tr><tr><td class="line-number" value="720"></td><td class="line-content">					\[\begin{align*}</td></tr><tr><td class="line-number" value="721"></td><td class="line-content">					\mathcal{L}_{t-1} - C &amp;= \frac{\beta_t^2}{2\sigma^2_t\alpha_t(1-\bar \alpha_t)}\mathbb{E}_{\boldsymbol \epsilon_t \sim \mathcal{N}(0, \mathrm{\bm I})} \left[ \left\lVert  \boldsymbol \epsilon_t  - \boldsymbol \epsilon_\theta(\sqrt{\bar \alpha_t} \boldsymbol x_0 + \sqrt{1-\bar \alpha_t}\boldsymbol \epsilon_t, t)\right\lVert^2 \right]</td></tr><tr><td class="line-number" value="722"></td><td class="line-content">					\end{align*}\]</td></tr><tr><td class="line-number" value="723"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="724"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="725"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>=""&gt;</span>With this reparameterization, we see that the objective of the model is to predict the noise that has been added to the data point.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="726"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="727"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>It is due to this interpretation that this model class is sometimes referred to as <span class="html-tag">&lt;em&gt;</span>Denoising Diffusion Probabilistic Models (DDPMs)<span class="html-tag">&lt;/em&gt;</span><span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="728"></td><td class="line-content">					</td></tr><tr><td class="line-number" value="729"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Note that for different \(t\), the added noise will be different, and the noise prediction model should receive information about which \(t\) it is currently dealing with.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="730"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="731"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="732"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="733"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="734"></td><td class="line-content">					<span class="html-tag">&lt;h3&gt;</span>Diffusion-based deep generative models: training objectives<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="735"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="736"></td><td class="line-content">					To summarize, we can train a denoising deep generative model by minimizing the following objective:</td></tr><tr><td class="line-number" value="737"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="738"></td><td class="line-content">					\[\begin{align*}\mathcal{L} =  \mathbb{E}_{x_0} \Biggl [&amp; \mathbb{E}_{q_{\boldsymbol \phi}(\boldsymbol x_{1} | \boldsymbol x_0)} \left [ \ln p_{\boldsymbol \theta}(\boldsymbol x_0|\boldsymbol x_1) \right ] \\</td></tr><tr><td class="line-number" value="739"></td><td class="line-content">					&amp;- (T-1)\mathbb{E}_{t\sim\mathcal{U}\{1, T-1\}} \left [ \frac{\beta_t^2}{2\sigma^2_t\alpha_t(1-\bar \alpha_t)} \mathbb{E}_{q(\boldsymbol \epsilon_t)} \left[ \left\lVert  \boldsymbol \epsilon_t  - \boldsymbol \epsilon_\theta(\boldsymbol x_t(\boldsymbol x_0, \boldsymbol \epsilon_t), t)\right\lVert^2 \right] \right ] \Biggl ]\end{align*}\]</td></tr><tr><td class="line-number" value="740"></td><td class="line-content">					<span class="html-comment">&lt;!-- \left[ \left\lVert  \boldsymbol \epsilon_t  - \boldsymbol \epsilon_\theta(\sqrt{\bar a_t} \boldsymbol x_0 + \sqrt{1-\bar a_t}\boldsymbol \epsilon_t, t)\right\lVert^2 \right ] \Biggl ]\end{align*}\] --&gt;</span></td></tr><tr><td class="line-number" value="741"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="742"></td><td class="line-content">					In the original paper by Ho et al, they also propose a simplified training objective (note the change of sign):</td></tr><tr><td class="line-number" value="743"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="744"></td><td class="line-content">					\[\begin{align*}\mathcal{L_\text{simple}} =  \mathbb{E}_{x_0} \mathbb{E}_{t\sim\mathcal{U}\{0, T-1\}} \mathbb{E}_{q(\boldsymbol \epsilon_t)} \left [ \left\lVert  \boldsymbol \epsilon_t  - \boldsymbol \epsilon_\theta(\boldsymbol x_t(\boldsymbol x_0, \boldsymbol \epsilon_t), t)\right\lVert^2 \right ] \end{align*}\]</td></tr><tr><td class="line-number" value="745"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="746"></td><td class="line-content">					It is this simplified objective that is often used in practice. It corresponds to a reweighted version of the (negative) ELBO.</td></tr><tr><td class="line-number" value="747"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="748"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="749"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="750"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">text-align:center</span>"&gt;</span></td></tr><tr><td class="line-number" value="751"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score matching<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="752"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="753"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="754"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:90%</span>"&gt;</span></td></tr><tr><td class="line-number" value="755"></td><td class="line-content">					<span class="html-tag">&lt;h3&gt;</span>Remember the "score"?<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="756"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="757"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>In the lecture on stochastic variational inference, we introduced the <span class="html-tag">&lt;em&gt;</span>score function<span class="html-tag">&lt;/em&gt;</span>:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="758"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="759"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="760"></td><td class="line-content">					\nabla_{\boldsymbol \theta}(\ln p(\boldsymbol x | \boldsymbol \theta))</td></tr><tr><td class="line-number" value="761"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="762"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="763"></td><td class="line-content">					This is sometimes called the <span class="html-tag">&lt;em&gt;</span>Fisher<span class="html-tag">&lt;/em&gt;</span> score function.</td></tr><tr><td class="line-number" value="764"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="765"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="766"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:1em</span>"&gt;</span>Today, we will consider a <span class="html-tag">&lt;strong&gt;</span>different<span class="html-tag">&lt;/strong&gt;</span> score function, sometimes called the <span class="html-tag">&lt;em&gt;</span>Stein<span class="html-tag">&lt;/em&gt;</span> score function:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="767"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="768"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="769"></td><td class="line-content">					\nabla_{\boldsymbol x}(\ln p(\boldsymbol x | \boldsymbol \theta))</td></tr><tr><td class="line-number" value="770"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="771"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="772"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Note that these are two very different quantities!<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="773"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="774"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="775"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="776"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="777"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score-based models<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="778"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="779"></td><td class="line-content">					Motivation: Consider the following very flexible probabilistic model:</td></tr><tr><td class="line-number" value="780"></td><td class="line-content">					\[p_{\boldsymbol \theta}(\boldsymbol x) = \frac{1}{Z_{\boldsymbol \theta}} \exp(-f_{\boldsymbol \theta}(\boldsymbol x))\]</td></tr><tr><td class="line-number" value="781"></td><td class="line-content">					The usual approach is to optimize by maximum log likelihood:</td></tr><tr><td class="line-number" value="782"></td><td class="line-content">					\[\mathcal{L}(\theta) = \sum_i^N \ln p(\boldsymbol x_i) = -\ln Z_{\boldsymbol \theta} - \sum_i^N f_{\boldsymbol \theta}(\boldsymbol x_i)\]</td></tr><tr><td class="line-number" value="783"></td><td class="line-content">					But \(Z_{\boldsymbol \theta}\) is itself an integral \(Z_{\boldsymbol \theta} = \int_{\boldsymbol x}\exp(-f_{\boldsymbol \theta}(\boldsymbol x))\), making this approach intractable in practice.</td></tr><tr><td class="line-number" value="784"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="785"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="786"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="787"></td><td class="line-content">							<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">flex-grow: 2.5;</span>"&gt;</span></td></tr><tr><td class="line-number" value="788"></td><td class="line-content">								<span class="html-tag">&lt;p&gt;</span>Central idea [1]: could we instead optimize a <span class="html-tag">&lt;em&gt;</span>score model<span class="html-tag">&lt;/em&gt;</span> \(s_{\boldsymbol \theta}\) that for each input \(\boldsymbol x\), reproduces the (Stein) score of the data distribution:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="789"></td><td class="line-content">								\[</td></tr><tr><td class="line-number" value="790"></td><td class="line-content">									s_{\boldsymbol \theta}(\boldsymbol x) \approx \nabla_{\boldsymbol x}(\ln p_\text{data}(\boldsymbol x))</td></tr><tr><td class="line-number" value="791"></td><td class="line-content">								\]</td></tr><tr><td class="line-number" value="792"></td><td class="line-content">								Writing up a score model for the example above, we see that \(\nabla_{\boldsymbol x} \ln Z_{\boldsymbol \theta} = 0\). We thus avoid the need of evaluating the normalization constant.			</td></tr><tr><td class="line-number" value="793"></td><td class="line-content">							<span class="html-tag">&lt;/div&gt;</span>	</td></tr><tr><td class="line-number" value="794"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="795"></td><td class="line-content">							<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="796"></td><td class="line-content">								<span class="html-tag">&lt;img <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:70%; float:right</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/images/score_contour.jpg" rel="noreferrer noopener">../images/score_contour.jpg</a>"&gt;</span></td></tr><tr><td class="line-number" value="797"></td><td class="line-content">								<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">text-align:right; float:right; width:90%; font-size:60%</span>"&gt;</span>Yang Song: Generative Modeling by Estimating Gradients of the Data Distribution, <span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://yang-song.net/blog/2021/score/" rel="noreferrer noopener">http://yang-song.net/blog/2021/score/</a>"&gt;</span>yang-song.net/blog/2021/score/<span class="html-tag">&lt;/a&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="798"></td><td class="line-content">							<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="799"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="800"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">text-align:right; margin-top:1em; float:right; width:90%; font-size:60%</span>"&gt;</span>[1] Hyv&amp;#228;rinen, Estimation of Non-Normalized Statistical Models by Score Matching, JMLR, 2005<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="801"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="802"></td><td class="line-content">					</td></tr><tr><td class="line-number" value="803"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="804"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="805"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="806"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="807"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score-based models: training objective<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="808"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="809"></td><td class="line-content">					As training objective, we use the mean squared error between all entries, aka the Fisher divergence:</td></tr><tr><td class="line-number" value="810"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="811"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="812"></td><td class="line-content">						\frac{1}{2}\mathbb{E}_{\boldsymbol x \sim p_\text{data}} \left [  \left \lVert s_{\boldsymbol \theta}(\boldsymbol x) - \nabla_{\boldsymbol x} \ln p_\text{data}(\boldsymbol x) \right \rVert^2_2 \right ]</td></tr><tr><td class="line-number" value="813"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="814"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="815"></td><td class="line-content">					The problem is that \(\nabla_{\boldsymbol x}(\ln p_\text{data}(\boldsymbol x))\) is not available to us.</td></tr><tr><td class="line-number" value="816"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="817"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="818"></td><td class="line-content">						<span class="html-tag">&lt;p&gt;</span>Trick: approximate \(p_\text{data}\) by a distribution \(q_\sigma\) obtained by adding noise to the input data: \(\tilde {\boldsymbol x} \sim q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x) = \mathcal{N}(\boldsymbol x, \sigma^2 \textrm{I})\), and write up the same expression for this distribution<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="819"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="820"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="821"></td><td class="line-content">					\frac{1}{2}\mathbb{E}_{\tilde {\boldsymbol x} \sim q_\sigma(\tilde {\boldsymbol x})} \left [  \left \lVert s_{\boldsymbol \theta}(\tilde {\boldsymbol x}) - \nabla_{\tilde {\boldsymbol x}} \ln q_\sigma(\tilde {\boldsymbol x}) \right \rVert^2_2 \right ]</td></tr><tr><td class="line-number" value="822"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="823"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="824"></td><td class="line-content">					Vincent [1] showed that optimizing this objective is equivalent to:</td></tr><tr><td class="line-number" value="825"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="826"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="827"></td><td class="line-content">						\frac{1}{2}\mathbb{E}_{\boldsymbol x \sim p_\text{data}} \mathbb{E}_{\tilde {\boldsymbol x} \sim q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x)} \left [  \left \lVert s_{\boldsymbol \theta}(\tilde {\boldsymbol x}) - \nabla_{\tilde {\boldsymbol x}}(\ln q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x)) \right \rVert^2_2 \right ]</td></tr><tr><td class="line-number" value="828"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="829"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="830"></td><td class="line-content">					We can evaluate this! This is called the <span class="html-tag">&lt;em&gt;</span>denoising score-matching<span class="html-tag">&lt;/em&gt;</span> objective.</td></tr><tr><td class="line-number" value="831"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="832"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 1em;float:right; width:90%; font-size:60%</span>"&gt;</span>[1] Vincent, A connection between score matching and denoising autoencoders. Neural computation 23.7, 2011<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="833"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="834"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="835"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="836"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="837"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="838"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score-based models: denoising score matching<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="839"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="840"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">border:1px solid lightgrey; padding:0.5em</span>"&gt;</span></td></tr><tr><td class="line-number" value="841"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="842"></td><td class="line-content">						\frac{1}{2}\mathbb{E}_{\boldsymbol x \sim p_\text{data}} \mathbb{E}_{\tilde {\boldsymbol x} \sim q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x)} \left [  \left \lVert s_{\boldsymbol \theta}(\tilde {\boldsymbol x}) - \nabla_{\tilde {\boldsymbol x}}(\ln q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x)) \right \rVert^2_2 \right ]</td></tr><tr><td class="line-number" value="843"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="844"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span>	</td></tr><tr><td class="line-number" value="845"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="846"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Since \(q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x)\) is \(\mathcal{N}(\boldsymbol x, \sigma^2 \mathrm{\bm I})\), we have </td></tr><tr><td class="line-number" value="847"></td><td class="line-content">						\[\nabla_{\tilde {\boldsymbol x}}(\ln q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x)) = \frac{1}{\sigma^2}(\tilde {\boldsymbol x} - \boldsymbol x) \hspace{2em} \text{\tiny Matrix cookbook eq 85}\]</td></tr><tr><td class="line-number" value="848"></td><td class="line-content">					<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="849"></td><td class="line-content"><span class="html-comment">&lt;!-- 						\[\frac{\partial \ln q_\sigma}{\partial x_d} = \frac{1}{\sigma^2}(\tilde x_d - x_d)\]&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="850"></td><td class="line-content"><span class="html-comment"> --&gt;</span></td></tr><tr><td class="line-number" value="851"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Intuition: the model \(s_{\boldsymbol \theta}\) will produce a vector field that pushes the noisy \(\tilde {\boldsymbol x}\) in the direction of \(\boldsymbol x.\)<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="852"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="853"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Note that at the same time, the noise \(\sigma\) should be small, so that \(q_\sigma(\boldsymbol x) \approx p(\boldsymbol x)\) <span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="854"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="855"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="856"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="857"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="858"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score-based models: can we generate from them?<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="859"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="860"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Problem: since we only have a model of the score, we cannot directly generate from the model.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="861"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="862"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>However, we can use an MCMC sampler.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="863"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="864"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>The simplest is to use Langevin dynamics, which is a simple version of the HMC method covered earlier in the course:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="865"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="866"></td><td class="line-content">						\boldsymbol x_{t+1} = \boldsymbol x_t + \tau \nabla_{\boldsymbol x}\ln p(\boldsymbol x) + \sqrt{2 \tau} \epsilon_i \hspace{2em} \text{where } \epsilon_i \sim \mathcal{N}(0, \bf \mathrm{I})</td></tr><tr><td class="line-number" value="867"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="868"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="869"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="870"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="871"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">flex-grow: 2.5;</span>"&gt;</span></td></tr><tr><td class="line-number" value="872"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>Note that we only need \(\nabla_{\boldsymbol x}\ln p(\boldsymbol x)\), to draw samples from \(p(\boldsymbol x)\).<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="873"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="874"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="875"></td><td class="line-content">						<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="876"></td><td class="line-content">							<span class="html-tag">&lt;img <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:100%; </span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/images/langevin.gif" rel="noreferrer noopener">../images/langevin.gif</a>" &gt;</span></td></tr><tr><td class="line-number" value="877"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="878"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="879"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 1em;text-align:right; float:right; width:90%; font-size:60%</span>"&gt;</span>Yang Song: Generative Modeling by Estimating Gradients of the Data Distribution, <span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://yang-song.net/blog/2021/score/" rel="noreferrer noopener">http://yang-song.net/blog/2021/score/</a>"&gt;</span>yang-song.net/blog/2021/score/<span class="html-tag">&lt;/a&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="880"></td><td class="line-content">				<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="881"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="882"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="883"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="884"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="885"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="886"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score-mathing: inaccuracies in low-density regions<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="887"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="888"></td><td class="line-content">					A problem of score-matching is that regions of low probability are disregarded</td></tr><tr><td class="line-number" value="889"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="890"></td><td class="line-content">						\frac{1}{2}\mathbb{E}_{\boldsymbol x \sim p_\text{data}} \left [  \left \lVert s_{\boldsymbol \theta}(\boldsymbol x) - \nabla_{\boldsymbol x} \ln p_\text{data}(\boldsymbol x) \right \rVert^2_2 \right ] = \frac{1}{2}\int {\color{red}p(\boldsymbol x)} \left \lVert s_{\boldsymbol \theta}(\boldsymbol x) - \nabla_{\boldsymbol x} \ln p_\text{data}(\boldsymbol x) \right \rVert^2_2 d{\boldsymbol x}</td></tr><tr><td class="line-number" value="891"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="892"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="893"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>This is a real problem, because at the beginning of our langevin simulation, the samples will tend to be in regions of low probability. If our estimates of the score is bad, the simulation will explode.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="894"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="895"></td><td class="line-content">					<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">center</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:60%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/images/pitfalls.jpg" rel="noreferrer noopener">../images/pitfalls.jpg</a>"&gt;</span></td></tr><tr><td class="line-number" value="896"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 0em;margin-bottom:1em; text-align:right; float:right; width:100%; font-size:60%</span>"&gt;</span>Yang Song: Generative Modeling by Estimating Gradients of the Data Distribution, <span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://yang-song.net/blog/2021/score/" rel="noreferrer noopener">http://yang-song.net/blog/2021/score/</a>"&gt;</span>yang-song.net/blog/2021/score/<span class="html-tag">&lt;/a&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="897"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="898"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="899"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>By adding more noise, we can potentially solve this problem - but there is a tradeof between adding enough noise for coverage and still having \(q_\sigma(\boldsymbol x) \approx p(\boldsymbol x)\)<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="900"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="901"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Idea: why don't we just add noise at many different levels at once?<span class="html-tag">&lt;/p&gt;</span>		</td></tr><tr><td class="line-number" value="902"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="903"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="904"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="905"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="906"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="907"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score-matching: multiple noise levels<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="908"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="909"></td><td class="line-content">					<span class="html-tag">&lt;ul&gt;</span></td></tr><tr><td class="line-number" value="910"></td><td class="line-content">						<span class="html-tag">&lt;li&gt;</span>Choose sequence of increasing noise levels: \(\sigma_1 \lt \sigma_2 \lt \ldots \lt \sigma_T \)<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="911"></td><td class="line-content">						<span class="html-tag">&lt;li&gt;</span>Create the corresponding distributions \(q_{\sigma_t}\), and write up the objective:</td></tr><tr><td class="line-number" value="912"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="913"></td><td class="line-content">							\[</td></tr><tr><td class="line-number" value="914"></td><td class="line-content">								\mathcal{L}(\boldsymbol \theta) = {\color{red}\sum_{t=1}^T\lambda_t}\mathbb{E}_{\boldsymbol x \sim p_\text{data}} \mathbb{E}_{\tilde {\boldsymbol x} \sim q_{\color{red}{\sigma_t}}(\tilde {\boldsymbol x} | \boldsymbol x)} \left [  \left \lVert s_{\boldsymbol \theta}(\tilde {\boldsymbol x}, {\color{red}t}) - \nabla_{\tilde {\boldsymbol x}}(\ln q_{\color{red}{\sigma_t}}(\tilde {\boldsymbol x} | \boldsymbol x)) \right \rVert^2_2 \right ]</td></tr><tr><td class="line-number" value="915"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="916"></td><td class="line-content">							where \(\lambda_t\) is a weight factor for each contribution - often set to \(\sigma^2_t\)</td></tr><tr><td class="line-number" value="917"></td><td class="line-content">		<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="918"></td><td class="line-content">					<span class="html-tag">&lt;/ul&gt;</span></td></tr><tr><td class="line-number" value="919"></td><td class="line-content">					</td></tr><tr><td class="line-number" value="920"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="921"></td><td class="line-content">					</td></tr><tr><td class="line-number" value="922"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">container</span>"&gt;</span></td></tr><tr><td class="line-number" value="923"></td><td class="line-content">						<span class="html-tag">&lt;div&gt;</span></td></tr><tr><td class="line-number" value="924"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="925"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="926"></td><td class="line-content">							<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Note that \(s_{\boldsymbol \theta}(\tilde {\boldsymbol x}, t)\) now takes \(t\) as an argument. This is called a <span class="html-tag">&lt;em&gt;</span>Noise Conditional Score Network (NCSN)<span class="html-tag">&lt;/em&gt;</span><span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="927"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="928"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="929"></td><td class="line-content">						<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="930"></td><td class="line-content">							<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">center</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:1em;width:100%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/images/multi_scale.jpg" rel="noreferrer noopener">../images/multi_scale.jpg</a>"&gt;</span></td></tr><tr><td class="line-number" value="931"></td><td class="line-content">							<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 1em;text-align:right; float:right; width:80%; font-size:60%</span>"&gt;</span>Yang Song: Generative Modeling by Estimating Gradients of the Data Distribution, <span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://yang-song.net/blog/2021/score/" rel="noreferrer noopener">http://yang-song.net/blog/2021/score/</a>"&gt;</span>yang-song.net/blog/2021/score/<span class="html-tag">&lt;/a&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="932"></td><td class="line-content">						<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="933"></td><td class="line-content">					<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="934"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="935"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="936"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="937"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="938"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="939"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="940"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score-matching: multiple noise levels - generation<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="941"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="942"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>To generate samples from our multi-noise-level model, we run <span class="html-tag">&lt;em&gt;</span>Annealed Langevin dynamics<span class="html-tag">&lt;/em&gt;</span>, where we start at high noise levels, and then transition into lower noise levels.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="943"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="944"></td><td class="line-content">					<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">center</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:80%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/images/ald.gif" rel="noreferrer noopener">../images/ald.gif</a>"&gt;</span></td></tr><tr><td class="line-number" value="945"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="946"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 1em;text-align:right; float:right; width:90%; font-size:60%</span>"&gt;</span>Yang Song: Generative Modeling by Estimating Gradients of the Data Distribution, <span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://yang-song.net/blog/2021/score/" rel="noreferrer noopener">http://yang-song.net/blog/2021/score/</a>"&gt;</span>yang-song.net/blog/2021/score/<span class="html-tag">&lt;/a&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="947"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="948"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="949"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="950"></td><td class="line-content">				<span class="html-tag">&lt;section&gt;</span></td></tr><tr><td class="line-number" value="951"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Doesn't this all sound very familiar?<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="952"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="953"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Let's compare the two model types side by side.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="954"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="955"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="956"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="957"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>Score matching vs diffusion-based models<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="958"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="959"></td><td class="line-content">					<span class="html-tag">&lt;dl&gt;</span></td></tr><tr><td class="line-number" value="960"></td><td class="line-content">						<span class="html-tag">&lt;dt <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-weight:400</span>"&gt;</span>Score matching training objective<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="961"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span></td></tr><tr><td class="line-number" value="962"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="963"></td><td class="line-content">						\mathcal{L_\text{SM}}(\boldsymbol \theta) = \mathbb{E}_{\boldsymbol x \sim p_\text{data}}\sum_{t=1}^T\sigma^2_t \mathbb{E}_{\tilde {\boldsymbol x} \sim \underbrace{q_{\sigma_t}(\tilde {\boldsymbol x}| \boldsymbol x)}_{\mathcal{N}(\boldsymbol x, \sigma^2_t\mathrm{\bm I})}} \left [  \left \lVert s_{\boldsymbol \theta}(\tilde {\boldsymbol x}, t) - \nabla_{\tilde {\boldsymbol x}}(\ln q_{\sigma_t}(\tilde {\boldsymbol x} | \boldsymbol x)) \right \rVert^2_2 \right ]</td></tr><tr><td class="line-number" value="964"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="965"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="966"></td><td class="line-content">						<span class="html-tag">&lt;dt <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-weight:400</span>"&gt;</span>Denoising diffusion model training objective<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="967"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span></td></tr><tr><td class="line-number" value="968"></td><td class="line-content">							\[\begin{align*}\mathcal{L_\text{DDPM}} &amp;=  \mathbb{E}_{\boldsymbol x_0 \sim p_\text{data}} \sum^{T} \mathbb{E}_{\boldsymbol \epsilon_t \sim \mathcal{N}(0,\mathrm{\bm I})} \left [ \left\lVert \boldsymbol \epsilon_\theta(\sqrt{\bar \alpha_t} \boldsymbol x_0 + \sqrt{1-\bar \alpha_t}\boldsymbol \epsilon_t, t) - \boldsymbol \epsilon_t  \right\lVert^2 \right ] \\</td></tr><tr><td class="line-number" value="969"></td><td class="line-content">							&amp;= \mathbb{E}_{\boldsymbol x_0 \sim p_\text{data}} \sum_{t=1}^{T} \mathbb{E}_{\boldsymbol x_t \sim \mathcal{N}(\sqrt{\bar \alpha_t}\boldsymbol x_0, 1-\bar \alpha_t)} \left [ \left\lVert \boldsymbol \epsilon_\theta(\boldsymbol x_t, t) - \boldsymbol \epsilon_t \right\lVert^2 \right ]</td></tr><tr><td class="line-number" value="970"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="971"></td><td class="line-content">							\end{align*}</td></tr><tr><td class="line-number" value="972"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="973"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="974"></td><td class="line-content">							<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="975"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="976"></td><td class="line-content">							But, as we saw, \(\nabla_{\tilde {\boldsymbol x}}(\ln q_\sigma(\tilde {\boldsymbol x} | \boldsymbol x)) = \frac{1}{\sigma^2}(\tilde {\boldsymbol x} - \boldsymbol x) = \frac{1}{\sigma^2}\boldsymbol \epsilon_\sigma\), so</td></tr><tr><td class="line-number" value="977"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="978"></td><td class="line-content">							\[\begin{align*}\mathcal{L_\text{DDPM}} &amp;=  \mathbb{E}_{\boldsymbol x_0 \sim p_\text{data}} \sum_{t=1}^{T} (1-\alpha_t) \mathbb{E}_{\boldsymbol x_t \sim \underbrace{q_t(\boldsymbol x_t | \boldsymbol x_0)}_{\mathcal{N}(\sqrt{\bar \alpha_t}\boldsymbol x_0, 1-\bar \alpha_t)}} \left [ \left\lVert s_{\boldsymbol \theta}(\boldsymbol x_t, t) - \nabla_{\boldsymbol x_t}(\ln q_t(\boldsymbol x_t | \boldsymbol x_0)) \right\lVert^2 \right ]</td></tr><tr><td class="line-number" value="979"></td><td class="line-content">							</td></tr><tr><td class="line-number" value="980"></td><td class="line-content">							\end{align*}</td></tr><tr><td class="line-number" value="981"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="982"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="983"></td><td class="line-content">							<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="984"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="985"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="986"></td><td class="line-content">					<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="987"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="988"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>So, apart from a different noising scheme, these are the same model.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="989"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="990"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Difference: the DDPM noising scheme allows for sampling using \(p_{\boldsymbol \theta}(\boldsymbol x_{t-1}|\boldsymbol x_t)\). For the score-based approach, we use Langevin dynamics.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="991"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="992"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="993"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="994"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="995"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="996"></td><td class="line-content">					<span class="html-tag">&lt;h3&gt;</span>A general framework: Stochastic differential equations<span class="html-tag">&lt;/h3&gt;</span></td></tr><tr><td class="line-number" value="997"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="998"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>In 2021, the authors from the two camps wrote a paper together about a unified framework for the two model types [1]. <span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="999"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1000"></td><td class="line-content">					Central ideas:</td></tr><tr><td class="line-number" value="1001"></td><td class="line-content">					<span class="html-tag">&lt;dl&gt;</span></td></tr><tr><td class="line-number" value="1002"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span></td></tr><tr><td class="line-number" value="1003"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>Generalize to an infinite number of noise levels, indexed by a continuous time variable \(t\).<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1004"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1005"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>Let the noised data distribution at time \(t\) be described by a stochastic differential equation (SDE).<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1006"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="1007"></td><td class="line-content">					<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="1008"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1009"></td><td class="line-content">					A full treatment of SDEs is far outside the scope of this course, but I'll try to provide a bit of intuition.</td></tr><tr><td class="line-number" value="1010"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1011"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 1em;text-align:right; float:right; width:90%; font-size:60%</span>"&gt;</span>[1] Song, Sohl-Dickstein, Kingma, Kumar, Ermon, Poole. Score-based generative modeling through stochastic differential equations, ICLR, 2021<span class="html-tag">&lt;/a&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="1012"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1013"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1014"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1015"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="1016"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>ODEs and SDEs: a two slide primer<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="1017"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1018"></td><td class="line-content">					<span class="html-tag">&lt;dl <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left:0</span>"&gt;</span></td></tr><tr><td class="line-number" value="1019"></td><td class="line-content">						<span class="html-tag">&lt;dt <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left:0; font-weight:400</span>"&gt;</span>Ordinary differential equation (ODE)<span class="html-tag">&lt;/dt&gt;</span> </td></tr><tr><td class="line-number" value="1020"></td><td class="line-content">						<span class="html-tag">&lt;dd <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left:0</span>"&gt;</span></td></tr><tr><td class="line-number" value="1021"></td><td class="line-content">							An equation that relates a function with its derivatives. Example:</td></tr><tr><td class="line-number" value="1022"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1023"></td><td class="line-content">							\[</td></tr><tr><td class="line-number" value="1024"></td><td class="line-content">							\frac{\mathrm{d}x}{\mathrm{d}t} = kx + g(t) \hspace{2em} \text{e.g. population of rabits affected by seasonal trends}</td></tr><tr><td class="line-number" value="1025"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="1026"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1027"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>The solution is a <span class="html-tag">&lt;em&gt;</span>function<span class="html-tag">&lt;/em&gt;</span> \(x(t)\): ODEs are a way to specify functions. <span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1028"></td><td class="line-content">								<span class="html-comment">&lt;!-- "Ordinary" just means that our function only depends on a single dependent variable.&lt;/p&gt; --&gt;</span></td></tr><tr><td class="line-number" value="1029"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1030"></td><td class="line-content">							<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="1031"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>For general ODEs, \(\frac{\mathrm{d}\boldsymbol x}{\mathrm{d}t} = f(\boldsymbol x, t)\) <span class="html-tag">&lt;a <span class="html-attribute-name">style</span>="<span class="html-attribute-value">position:relative;</span>" <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement.parentElement).find('div.popup').toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-q</span>"&gt;</span>?<span class="html-tag">&lt;/a&gt;</span>, we cannot find a closed-form expression for the solution. We can <span class="html-tag">&lt;em&gt;</span>simulate<span class="html-tag">&lt;/em&gt;</span> it by integrating over small increments:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1032"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1033"></td><td class="line-content">								<span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup</span>"&gt;</span></td></tr><tr><td class="line-number" value="1034"></td><td class="line-content">									<span class="html-tag">&lt;div <span class="html-attribute-name">onclick</span>="<span class="html-attribute-value">$(this.parentElement).toggle()</span>" <span class="html-attribute-name">class</span>="<span class="html-attribute-value">popup-close</span>"&gt;</span>×<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="1035"></td><td class="line-content">									Although it looks simple, this is actually a general form. Higher order ODEs can typically be rewritten in terms of single-order <span class="html-tag">&lt;em&gt;</span>vector<span class="html-tag">&lt;/em&gt;</span> differential equation. For details, see chapter 1 of Särkkä and Solin's "Applied Stochastic Differential Equations".</td></tr><tr><td class="line-number" value="1036"></td><td class="line-content">								<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="1037"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1038"></td><td class="line-content">							\[\boldsymbol x(t_0+\Delta t) = \boldsymbol x(t_0) + \int_{t_0}^{t_0 + \Delta t} f(\boldsymbol x(\tau), \tau)\mathrm{d}\tau \hspace{2em}\text{and so forth for } (t_0+\Delta t)+\Delta t \text{ etc}\]</td></tr><tr><td class="line-number" value="1039"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1040"></td><td class="line-content">							<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="1041"></td><td class="line-content">							<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="1042"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1043"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>Since we cannot evaluate this integral, we must approximate it. The simplest is Euler's approximation, assuming a constant \(f\) from \(t\) to \(t + \Delta t\):<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1044"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1045"></td><td class="line-content">							\[\boldsymbol x(t+\Delta t) = \boldsymbol x(t) + f(\boldsymbol x(t), t)\Delta t \hspace{2em}\text{Eulers method - better simulators exist}\]</td></tr><tr><td class="line-number" value="1046"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1047"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>Note that we need to know boundary conditions like \(x(t_0)\) to solve or simulate an ODE.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1048"></td><td class="line-content">							<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="1049"></td><td class="line-content"><span class="html-comment">&lt;!-- </span></td></tr><tr><td class="line-number" value="1050"></td><td class="line-content"><span class="html-comment">							&lt;span class="fragment"&gt;</span></td></tr><tr><td class="line-number" value="1051"></td><td class="line-content"><span class="html-comment">							Terminology:</span></td></tr><tr><td class="line-number" value="1052"></td><td class="line-content"><span class="html-comment">							&lt;ul&gt;</span></td></tr><tr><td class="line-number" value="1053"></td><td class="line-content"><span class="html-comment">								&lt;li&gt;\(x\) is called the &lt;em&gt;dependent&lt;/em&gt; variable and \(t\) is the &lt;em&gt;independent&lt;/em&gt; variable. &lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1054"></td><td class="line-content"><span class="html-comment">								&lt;li class="fragment"&gt;The term &lt;em&gt;ordinary&lt;/em&gt; means that we only have a single independent variable (i.e. derivatives rather than partial derivatives)&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1055"></td><td class="line-content"><span class="html-comment">								&lt;li class="fragment"&gt;The &lt;em&gt;order&lt;/em&gt; of an ODE is determined by the highest order derivative.&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1056"></td><td class="line-content"><span class="html-comment">								&lt;li class="fragment"&gt;If we add a term depending on \(t\), the ODE becomes &lt;em&gt;inhomogeneous&lt;/em&gt;:</span></td></tr><tr><td class="line-number" value="1057"></td><td class="line-content"><span class="html-comment">									\[</span></td></tr><tr><td class="line-number" value="1058"></td><td class="line-content"><span class="html-comment">									\frac{\mathrm{d}x}{\mathrm{d}t} = kx + f(t) \hspace{2em} \text{e.g. rabit population affected by seasonal trends}</span></td></tr><tr><td class="line-number" value="1059"></td><td class="line-content"><span class="html-comment">									\]</span></td></tr><tr><td class="line-number" value="1060"></td><td class="line-content"><span class="html-comment">								&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1061"></td><td class="line-content"><span class="html-comment">								&lt;li class="fragment"&gt;A solution requires that we specify initial conditions - e.g. the initial population of rabits.</span></td></tr><tr><td class="line-number" value="1062"></td><td class="line-content"><span class="html-comment">								&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1063"></td><td class="line-content"><span class="html-comment">							&lt;/ul&gt; --&gt;</span></td></tr><tr><td class="line-number" value="1064"></td><td class="line-content">							<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="1065"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="1066"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1067"></td><td class="line-content">					<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="1068"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1069"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1070"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1071"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="1072"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>ODEs and SDEs: a two slide primer (2)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="1073"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1074"></td><td class="line-content">					<span class="html-tag">&lt;dl <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left:0</span>"&gt;</span></td></tr><tr><td class="line-number" value="1075"></td><td class="line-content">						<span class="html-tag">&lt;dt <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left:0; font-weight:400</span>"&gt;</span>Stochastic differential equation (SDE)<span class="html-tag">&lt;/dt&gt;</span> </td></tr><tr><td class="line-number" value="1076"></td><td class="line-content">						<span class="html-tag">&lt;dd <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-left:0</span>"&gt;</span></td></tr><tr><td class="line-number" value="1077"></td><td class="line-content">							A differential equation containing terms that are stochastic processes. Example</td></tr><tr><td class="line-number" value="1078"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1079"></td><td class="line-content">							\[</td></tr><tr><td class="line-number" value="1080"></td><td class="line-content">							\mathrm{d}x = (kx) \mathrm{d}t + g(t)\mathrm{d} W, \hspace{3em}\text{where }W \text{ is a Wiener process}</td></tr><tr><td class="line-number" value="1081"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="1082"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1083"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>The solution is a <span class="html-tag">&lt;em&gt;</span>stochastic process<span class="html-tag">&lt;/em&gt;</span>: SDEs are a way to specify stochastic processes.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1084"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1085"></td><td class="line-content">							<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="1086"></td><td class="line-content">							<span class="html-tag">&lt;p&gt;</span>To interpret the SDE above we can consider how we would simulate from it (Euler-Maruyama approximation):<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1087"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1088"></td><td class="line-content">							\[</td></tr><tr><td class="line-number" value="1089"></td><td class="line-content">								\boldsymbol x(t+\Delta t) = x(t) + kx(t)\Delta t + g(t)\underbrace{\Delta W}_{W_{t+\Delta t} - W_t}</td></tr><tr><td class="line-number" value="1090"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="1091"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1092"></td><td class="line-content">							The Wiener process is defined such that \(W_{t+\Delta t} - W_t\) is \(\mathcal{N}(0, \Delta t)\). Intuitively, it thus behaves as the ODE, but adding Gaussian noise in each step.</td></tr><tr><td class="line-number" value="1093"></td><td class="line-content">							<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="1094"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="1095"></td><td class="line-content">					<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="1096"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1097"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1098"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="1099"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>A general framework: forward direction<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="1100"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1101"></td><td class="line-content">					The Song et al paper proposed to consider solutions to an &amp;#206;to SDE:</td></tr><tr><td class="line-number" value="1102"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1103"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="1104"></td><td class="line-content">					\textrm{d}\boldsymbol x = \underbrace{f(\boldsymbol x, t)}_\text{drift}\textrm{d}t + \underbrace{g(t)}_\text{diffusion}\textrm{d}W</td></tr><tr><td class="line-number" value="1105"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="1106"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1107"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>It is known that if \(f\) is affine, then \(q(\boldsymbol x_t | \boldsymbol x_0)\) is Gaussian, typically with closed form solutions for the mean and the variance (just as we saw for the DDPM).<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1108"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1109"></td><td class="line-content">					<span class="html-tag">&lt;span&gt;</span></td></tr><tr><td class="line-number" value="1110"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>We can now define a score matching training objective for the continuous case:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1111"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1112"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="1113"></td><td class="line-content">						\mathcal{L_\text{SM}}(\boldsymbol \theta) = \mathbb{E}_{\boldsymbol x{\color{red}(0)} \sim p_\text{data}} \mathbb{E}_{\color{red}{t\sim\mathcal{U[0,1]}}} \left [ \lambda(t) \mathbb{E}_{\boldsymbol x{\color{red}(t)} \sim q_{\sigma_t}(\boldsymbol x{\color{red}(t)}| \boldsymbol x{\color{red}(0)})} \left [  \left \lVert s_{\boldsymbol \theta}(\boldsymbol x{\color{red}(t)}, t) - \nabla_{\boldsymbol x{\color{red}(t)}}(\ln q(\boldsymbol x{\color{red}(t)} | \boldsymbol x{\color{red}(0)})) \right \rVert^2_2 \right ]\right ]</td></tr><tr><td class="line-number" value="1114"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="1115"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1116"></td><td class="line-content">					Where we have replaced the sum over the T noise levels with an expectation over a continuous \(\mathcal{U[0,1]}\) distribution.</td></tr><tr><td class="line-number" value="1117"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1118"></td><td class="line-content">					<span class="html-tag">&lt;p <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span>Note that the goal now is to estimate the score for all values \(t\) in \([0,1]\), rather than at discrete intervals.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1119"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1120"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span>					</td></tr><tr><td class="line-number" value="1121"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1122"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1123"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:70%</span>"&gt;</span></td></tr><tr><td class="line-number" value="1124"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>A general framework: reverse direction<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="1125"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1126"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>What about generation?<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1127"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1128"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>It turns out that the reverse of an SDE is also an SDE:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1129"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1130"></td><td class="line-content">					\[</td></tr><tr><td class="line-number" value="1131"></td><td class="line-content">					\textrm{d}\boldsymbol x = f(\boldsymbol x, t)\textrm{d}t - g(t)^2\nabla_{\boldsymbol x}\ln q_t(\boldsymbol x)\textrm{d}\bar W</td></tr><tr><td class="line-number" value="1132"></td><td class="line-content">					\]</td></tr><tr><td class="line-number" value="1133"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1134"></td><td class="line-content">					where \(\textrm{d}\) is a negative increment, and \(\bar W\) is a Wiener process where time runs backwards.</td></tr><tr><td class="line-number" value="1135"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1136"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Note that the score appears in this expression. Since we have estimated this quantity for all \(t\), we can simulate the reverse SDE to draw samples from our model.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1137"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1138"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="1139"></td><td class="line-content">					<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">center</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:70%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/images/teaser.jpg" rel="noreferrer noopener">../images/teaser.jpg</a>"&gt;</span></td></tr><tr><td class="line-number" value="1140"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1141"></td><td class="line-content">					<span class="html-tag">&lt;div <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top: 1em;text-align:right; float:right; width:90%; font-size:60%</span>"&gt;</span>Yang Song: Generative Modeling by Estimating Gradients of the Data Distribution, <span class="html-tag">&lt;br&gt;</span><span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://yang-song.net/blog/2021/score/" rel="noreferrer noopener">http://yang-song.net/blog/2021/score/</a>"&gt;</span>yang-song.net/blog/2021/score/<span class="html-tag">&lt;/a&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="1142"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span>						</td></tr><tr><td class="line-number" value="1143"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1144"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1145"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1146"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:75%</span>"&gt;</span></td></tr><tr><td class="line-number" value="1147"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>A general framework: what have we gained? (1)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="1148"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1149"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Have we learned anything by moving to the continuous case?<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1150"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1151"></td><td class="line-content">					<span class="html-tag">&lt;span <span class="html-attribute-name">class</span>="<span class="html-attribute-value">fragment</span>"&gt;</span></td></tr><tr><td class="line-number" value="1152"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>We can now understand the SM and DDPM models as discretizations of two different SDEs.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1153"></td><td class="line-content">					</td></tr><tr><td class="line-number" value="1154"></td><td class="line-content">					<span class="html-tag">&lt;dl&gt;</span></td></tr><tr><td class="line-number" value="1155"></td><td class="line-content">						<span class="html-tag">&lt;dt <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-weight:400</span>"&gt;</span>Score-based model<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="1156"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span></td></tr><tr><td class="line-number" value="1157"></td><td class="line-content">							\[</td></tr><tr><td class="line-number" value="1158"></td><td class="line-content">							\boldsymbol x_t = x_{t-1} + \sqrt{\sigma^2_t - \sigma^2_{t-t}}\epsilon_{t-1} \hspace{1em} \Rightarrow \hspace{1em} \textrm{d}\boldsymbol x = \frac{\sqrt{\textrm{d}\sigma^2(t)}}{\textrm{d}t}\textrm{d}W</td></tr><tr><td class="line-number" value="1159"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="1160"></td><td class="line-content">							referred to as <span class="html-tag">&lt;em&gt;</span>Variance exploding SDE<span class="html-tag">&lt;/em&gt;</span>.</td></tr><tr><td class="line-number" value="1161"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="1162"></td><td class="line-content">						<span class="html-tag">&lt;dt <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-weight:400; margin-top:1em</span>"&gt;</span>Diffusion-based model<span class="html-tag">&lt;/dt&gt;</span></td></tr><tr><td class="line-number" value="1163"></td><td class="line-content">						<span class="html-tag">&lt;dd&gt;</span></td></tr><tr><td class="line-number" value="1164"></td><td class="line-content">							\[</td></tr><tr><td class="line-number" value="1165"></td><td class="line-content">							\boldsymbol x_t = \sqrt{1-\beta_t}x_{t-1} + \sqrt{\beta_i}\epsilon_{t-1} \hspace{1em} \Rightarrow \hspace{1em} \textrm{d}\boldsymbol x = -\frac{1}{2}\beta(t)\boldsymbol x \mathrm{d}t + \sqrt{\beta(t)}\mathrm{d}W</td></tr><tr><td class="line-number" value="1166"></td><td class="line-content">							\]</td></tr><tr><td class="line-number" value="1167"></td><td class="line-content">							referred to as <span class="html-tag">&lt;em&gt;</span>Variance preserving SDE<span class="html-tag">&lt;/em&gt;</span>.</td></tr><tr><td class="line-number" value="1168"></td><td class="line-content">						<span class="html-tag">&lt;/dd&gt;</span></td></tr><tr><td class="line-number" value="1169"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1170"></td><td class="line-content">					<span class="html-tag">&lt;/dl&gt;</span></td></tr><tr><td class="line-number" value="1171"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1172"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>The framework makes it possible to start exploring other SDEs as well.<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1173"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1174"></td><td class="line-content">					<span class="html-tag">&lt;/span&gt;</span></td></tr><tr><td class="line-number" value="1175"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1176"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1177"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="1178"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>A general framework: what have we gained? (2)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="1179"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1180"></td><td class="line-content">					<span class="html-tag">&lt;p&gt;</span>Other advantages:<span class="html-tag">&lt;/p&gt;</span></td></tr><tr><td class="line-number" value="1181"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1182"></td><td class="line-content">					<span class="html-tag">&lt;ul&gt;</span></td></tr><tr><td class="line-number" value="1183"></td><td class="line-content">						<span class="html-tag">&lt;li&gt;</span>We can use the whole SDE toolbox to come up with efficient samplers, making it possible to make the generation process more efficient.<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1184"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1185"></td><td class="line-content">						<span class="html-tag">&lt;li <span class="html-attribute-name">style</span>="<span class="html-attribute-value">margin-top:1em</span>"&gt;</span>It turns out that once the score has been determined, the reverse-time process can be transformed into a deterministic process (described by an ODE). This allows:</td></tr><tr><td class="line-number" value="1186"></td><td class="line-content">							<span class="html-tag">&lt;ul&gt;</span></td></tr><tr><td class="line-number" value="1187"></td><td class="line-content">								<span class="html-tag">&lt;li&gt;</span>exact likelihood calculation in diffusion models<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1188"></td><td class="line-content">								<span class="html-tag">&lt;li&gt;</span>well-defined "latent" representations<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1189"></td><td class="line-content">								<span class="html-tag">&lt;li&gt;</span>More efficient generation<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1190"></td><td class="line-content">							<span class="html-tag">&lt;/ul&gt;</span></td></tr><tr><td class="line-number" value="1191"></td><td class="line-content">						<span class="html-tag">&lt;/li&gt;</span></td></tr><tr><td class="line-number" value="1192"></td><td class="line-content">					<span class="html-tag">&lt;/ul&gt;</span></td></tr><tr><td class="line-number" value="1193"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1194"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1195"></td><td class="line-content">				<span class="html-tag">&lt;section <span class="html-attribute-name">style</span>="<span class="html-attribute-value">font-size:80%</span>"&gt;</span></td></tr><tr><td class="line-number" value="1196"></td><td class="line-content">					<span class="html-tag">&lt;h2&gt;</span>A general framework: what have we gained? (3)<span class="html-tag">&lt;/h2&gt;</span></td></tr><tr><td class="line-number" value="1197"></td><td class="line-content">					High quality image generators:</td></tr><tr><td class="line-number" value="1198"></td><td class="line-content">					<span class="html-tag">&lt;img <span class="html-attribute-name">class</span>="<span class="html-attribute-value">center</span>" <span class="html-attribute-name">style</span>="<span class="html-attribute-value">width:90%</span>" <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/images/ffhq_1024.jpeg" rel="noreferrer noopener">../images/ffhq_1024.jpeg</a>"&gt;</span></td></tr><tr><td class="line-number" value="1199"></td><td class="line-content">				<span class="html-tag">&lt;/section&gt;</span></td></tr><tr><td class="line-number" value="1200"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1201"></td><td class="line-content">			<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="1202"></td><td class="line-content">		<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="1203"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1204"></td><td class="line-content">		<span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/dist/reveal.js" rel="noreferrer noopener">../reveal.js-4.5.0/dist/reveal.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1205"></td><td class="line-content">		<span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/plugin/notes/notes.js" rel="noreferrer noopener">../reveal.js-4.5.0/plugin/notes/notes.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1206"></td><td class="line-content">		<span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/plugin/markdown/markdown.js" rel="noreferrer noopener">../reveal.js-4.5.0/plugin/markdown/markdown.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1207"></td><td class="line-content">		<span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/plugin/highlight/highlight.js" rel="noreferrer noopener">../reveal.js-4.5.0/plugin/highlight/highlight.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1208"></td><td class="line-content">		<span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/plugin/math/math.js" rel="noreferrer noopener">../reveal.js-4.5.0/plugin/math/math.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1209"></td><td class="line-content">		<span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/reveal.js-4.5.0/plugin/zoom/zoom.js" rel="noreferrer noopener">../reveal.js-4.5.0/plugin/zoom/zoom.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1210"></td><td class="line-content">		<span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="1211"></td><td class="line-content">			// More info about initialization &amp; config:</td></tr><tr><td class="line-number" value="1212"></td><td class="line-content">			// - https://revealjs.com/initialization/</td></tr><tr><td class="line-number" value="1213"></td><td class="line-content">			// - https://revealjs.com/config/</td></tr><tr><td class="line-number" value="1214"></td><td class="line-content">			Reveal.initialize({</td></tr><tr><td class="line-number" value="1215"></td><td class="line-content">				katex: {</td></tr><tr><td class="line-number" value="1216"></td><td class="line-content">					trust:true</td></tr><tr><td class="line-number" value="1217"></td><td class="line-content">				},</td></tr><tr><td class="line-number" value="1218"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1219"></td><td class="line-content">				hash: true,</td></tr><tr><td class="line-number" value="1220"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1221"></td><td class="line-content">				slideNumber: true,</td></tr><tr><td class="line-number" value="1222"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1223"></td><td class="line-content">				transitionSpeed: 'fast',</td></tr><tr><td class="line-number" value="1224"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1225"></td><td class="line-content">				// Learn about plugins: https://revealjs.com/plugins/</td></tr><tr><td class="line-number" value="1226"></td><td class="line-content">				// plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.MathJax2 ]</td></tr><tr><td class="line-number" value="1227"></td><td class="line-content">				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom, RevealMath.KaTeX() ]</td></tr><tr><td class="line-number" value="1228"></td><td class="line-content">			});</td></tr><tr><td class="line-number" value="1229"></td><td class="line-content">		<span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1230"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1231"></td><td class="line-content"><span class="html-comment">&lt;!--		&lt;script src="../jquery-3.6.0.min.js"&gt;&lt;/script&gt;--&gt;</span></td></tr><tr><td class="line-number" value="1232"></td><td class="line-content"><span class="html-comment">&lt;!--	  &lt;script&gt;--&gt;</span></td></tr><tr><td class="line-number" value="1233"></td><td class="line-content"><span class="html-comment">&lt;!--			$(document).ready(function() {--&gt;</span></td></tr><tr><td class="line-number" value="1234"></td><td class="line-content"><span class="html-comment">&lt;!--				$(".prml.center").removeClass('center').wrap('&lt;div class="pmrlref" style="text-align: center"&gt;&lt;/div&gt;').parent().append('&lt;span style="writing-mode: vertical-rl; display: inline-block; font-size: 30%; margin-top:10%; vertical-align: top"&gt;Pattern Recognition and Machine Learning, Bishop&lt;/span&gt;');--&gt;</span></td></tr><tr><td class="line-number" value="1235"></td><td class="line-content"><span class="html-comment">&lt;!--			});--&gt;</span></td></tr><tr><td class="line-number" value="1236"></td><td class="line-content"><span class="html-comment">&lt;!--		&lt;/script&gt;--&gt;</span></td></tr><tr><td class="line-number" value="1237"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1238"></td><td class="line-content">				<span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="https://wouterboomsma.github.io/pml2024/jquery-3.6.0.min.js" rel="noreferrer noopener">../jquery-3.6.0.min.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1239"></td><td class="line-content">			  <span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="1240"></td><td class="line-content">					$(document).ready(function() {</td></tr><tr><td class="line-number" value="1241"></td><td class="line-content">						$(".prml").wrap('&lt;a href="https://www.microsoft.com/en-us/research/people/cmbishop/prml-book" title="Figure from Pattern Recognition and Machine Learning, by Christopher Bishop."/&gt;&lt;/a&gt;');</td></tr><tr><td class="line-number" value="1242"></td><td class="line-content">					});</td></tr><tr><td class="line-number" value="1243"></td><td class="line-content">				<span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="1244"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="1245"></td><td class="line-content">	<span class="html-tag">&lt;/body&gt;</span></td></tr><tr><td class="line-number" value="1246"></td><td class="line-content"><span class="html-tag">&lt;/html&gt;</span></td></tr><tr><td class="line-number" value="1247"></td><td class="line-content"><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>